<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Thai Trip 2026 - Hua Hin & Bangkok</title>
    
    <!-- Adobe Fonts (Typekit) -->
    <script>
      (function(d) {
        var config = {
          kitId: 'pxu2jie',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);
    </script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['monotalic', 'Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                },
            },
        }
    </script>
    
    <!-- Google Fonts (Backup) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Playfair+Display:ital@1&display=swap" rel="stylesheet">

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>

    <style>
        /* å¼·åˆ¶å…¨ç«™å­—é«”è¨­å®š */
        :root {
            --font-main: 'monotalic', 'Inter', sans-serif;
        }

        body, button, input, select, textarea, div, span, p, h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-main) !important;
            font-style: normal;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            background-color: #C4E0E0;
            -webkit-tap-highlight-color: transparent;
            overflow: hidden;
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        /* Slide Up Animation for Chat */
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slideUp 0.3s ease-out forwards;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Plane, MapPin, Calendar, Home, User, ArrowRight, ChevronLeft, 
            ChevronDown, ChevronUp, MoreHorizontal, Clock, Users, Sun, Moon, 
            Info, CheckSquare, Thermometer, Zap, Banknote, Phone, Utensils, 
            Coffee, ShoppingBag, Camera, BedDouble, RefreshCcw, Wifi, 
            AlertCircle, Key, Cloud, CloudRain, Wind, ExternalLink, Map as MapIcon, FileText, Luggage, Replace,
            MessageSquare, Send, Bot, X
        } from 'lucide-react';

        // --- Global Model Configuration ---
        const LITE_API = 'gemini-2.5-flash-lite-preview-09-2025';
        const FLASH_API = 'gemini-2.5-flash-preview-09-2025';

        const getModelDisplayName = (apiName) => {
            if (apiName === FLASH_API) return 'Gemini 2.5 Flash';
            return 'Gemini 2.5 Flash Lite';
        };

        // --- Global Data Sources ---
        
        const TRIP_DATA = {
            '2/25': {
                title: "Departure Night",
                desc: "Taoyuan Airport -> Bangkok",
                icon: <Plane size={20} />,
                events: [
                    { time: "19:45", title: "æ¡ƒåœ’æ©Ÿå ´é›†åˆ", desc: "TPE æ¡ƒåœ’æ©Ÿå ´é›†åˆ (ç„¡ç¶²ä¸Šå ±åˆ°ï¼Œéœ€è‡¨æ«ƒ)", icon: "users" },
                    { time: "21:15", title: "æ­ä¹˜ SL395 èµ·é£›", desc: "å‰å¾€æ›¼è°·å»Šæ›¼æ©Ÿå ´ (DMK)", icon: "plane" },
                    { time: "00:15", title: "æŠµé”æ›¼è°· DMK", desc: "é è¨ˆæŠµé”æ™‚é–“ (è·¨æ—¥ 2/26)", icon: "map-pin" },
                    { time: "01:15", title: "å…¥ä½é£¯åº—", desc: "SHIN Patara Living Hotel", icon: "moon" }
                ]
            },
            '2/26': {
                title: "Hua Hin Transfer",
                desc: "Bangkok -> Hua Hin Beach",
                icon: <Sun size={20} />,
                events: [
                    { time: "09:00", title: "æ›éŒ¢å°åˆ†éšŠå‡ºå‹•", desc: "å”åŠ©å¤§å®¶æ›è¯æ¬£å…©æ—¥èŠ±è²»", icon: "banknote" },
                    { time: "10:00", title: "åŒ…è»Šå‰å¾€è¯æ¬£", desc: "è»Šç¨‹ç´„ 3-3.5 å°æ™‚ï¼Œä¸­é€”åœ 7-11/Amazon", icon: "car" },
                    { time: "13:00", title: "æŠµé”é£¯åº—", desc: "The Standard Hua Hin", icon: "home" },
                    { time: "14:00", title: "åˆé¤ Nong JJ", desc: "åœ¨åœ°çŸ¥åé¤å»³", icon: "utensils", link: "https://maps.app.goo.gl/SjoAAn4g1RwRJu6y5" },
                    { time: "15:30", title: "è‡ªç”±æ´»å‹•", desc: "äº«å—é£¯åº—è¨­æ–½æˆ–æµ·ç˜", icon: "coffee" },
                    { time: "19:30", title: "æ™šé¤ PraÃ§a", desc: "é£¯åº—å…§é¤å»³äº«ç”¨æ³°å¼æ–™ç†", icon: "utensils", link: "https://maps.app.goo.gl/YVReUVe6M383Uzgz9" }
                ]
            },
            '2/27': {
                title: "Explore or Chill",
                desc: "Sam Roi Yot / Night Markets",
                icon: <Camera size={20} />,
                events: [
                    { time: "06:30", title: "æ—©é¤ / æº–å‚™å‡ºç™¼", desc: "åƒåŠ ä¸‰ç™¾å³°è€…å…ˆè¡Œç”¨é¤", icon: "coffee" },
                    { time: "08:00", title: "ä¸‰ç™¾å³°åœ‹å®¶å…¬åœ’", desc: "ç§äººæ¢ç´¢ä¹‹æ—… (åƒåŠ è€…å‡ºç™¼)", icon: "camera" },
                    { time: "09:00", title: "è‡ªç”±æ´»å‹•", desc: "æ²’åƒåŠ è¡Œç¨‹è€…å¯äº«å—é£¯åº—/æŒ‰æ‘©", icon: "sun" },
                    { time: "18:30", title: "é›†åˆé€›å¤œå¸‚", desc: "Cicada + Tamarind Night Markets", icon: "shopping-bag" },
                    { time: "21:00", title: "æŒ‰æ‘©/è³¼ç‰©", desc: "Let's Relax Spa æˆ– BlÃºport å¤§è³£å ´", icon: "moon" }
                ]
            },
            '2/28': {
                title: "Back to BKK",
                desc: "Hua Hin -> Bangkok City",
                icon: <ShoppingBag size={20} />,
                events: [
                    { time: "09:00", title: "åŒ…è»Šå›æ›¼è°·", desc: "è»Šç¨‹ç´„ 3-3.5 å°æ™‚", icon: "car" },
                    { time: "12:00", title: "Check-in BKK", desc: "ASAI Bangkok Chinatown", icon: "home" },
                    { time: "12:30", title: "åˆé¤ Ari å€", desc: "Ari å€äº«ç”¨åˆé¤", icon: "utensils" },
                    { 
                        time: "14:00", 
                        title: "è‡ªç”±é€›è¡—è·¯ç·š (ä¸‰é¸ä¸€)", 
                        desc: (
                        <ul className="space-y-3 mt-3">
                            <li className="flex gap-2 items-start">
                            <span className="shrink-0 font-bold bg-[#0F1C20] text-[#FF9F68] text-[10px] px-1.5 rounded py-0.5 mt-0.5">A</span>
                            <span><span className="font-bold">æ°åœ–æ° + DD Mall</span> é€›è¡— â” éš¨å¾Œå‰å¾€åµ©è¶Šè·¯é€›è¡—</span>
                            </li>
                            <li className="flex gap-2 items-start">
                            <span className="shrink-0 font-bold bg-[#0F1C20] text-[#FF9F68] text-[10px] px-1.5 rounded py-0.5 mt-0.5">B</span>
                            <span>å«è»Šè‡³ <span className="font-bold">æ³°åœ‹è¨­è¨ˆä¸­å¿ƒ (TCDC)</span> æˆ–æ­ BTS åˆ° Saphan Taksin ç«™ â” æ…¢æ…¢é€›åˆ°åµ©è¶Šè·¯</span>
                            </li>
                            <li className="flex gap-2 items-start">
                            <span className="shrink-0 font-bold bg-[#0F1C20] text-[#FF9F68] text-[10px] px-1.5 rounded py-0.5 mt-0.5">C</span>
                            <span>ç›´æ¥åœ¨ <span className="font-bold">Ari å€</span> é€›è¡—å–å’–å•¡ä¼‘æ¯ â” éš¨å¾Œå‰å¾€åµ©è¶Šè·¯é€›è¡—</span>
                            </li>
                        </ul>
                        ), 
                        icon: "map" 
                    },
                    { time: "18:30", title: "æ™šé¤ Lon Lon Local Diner", desc: "é›†åˆåƒæ™šé¤", icon: "utensils", link: "https://maps.app.goo.gl/oDgChLURo5wJHGYF7" },
                    { time: "20:00", title: "æ™šé–“æ´»å‹•", desc: "æŒ‰æ‘© / BigC æ¡è²· / ä¼‘æ¯", icon: "moon" }
                ]
            },
            '3/1': {
                title: "Bangkok Vibes",
                desc: "Temples, Shopping & Night Out",
                icon: <Camera size={20} />,
                events: [
                    { time: "06:30", title: "é£¯åº—æ—©é¤", desc: "ä¾›æ‡‰æ™‚é–“è‡³ 10:30", icon: "coffee" },
                    { 
                        time: "09:00", 
                        title: "åˆ†éšŠè¡Œå‹• (æ—©ä¸Š)", 
                        desc: (
                        <ul className="space-y-2 mt-2">
                            <li className="flex gap-2 items-start">
                            <span className="shrink-0 font-bold bg-[#0F1C20] text-[#FF9F68] text-[10px] px-1.5 rounded py-0.5 mt-0.5">AéšŠ</span>
                            <span>09:00 é„­ç‹å»Ÿåƒè§€ + é«”é©—æ³°æœ</span>
                            </li>
                            <li className="flex gap-2 items-start">
                            <span className="shrink-0 font-bold bg-[#0F1C20] text-[#FF9F68] text-[10px] px-1.5 rounded py-0.5 mt-0.5">BéšŠ</span>
                            <span>10:00 é€šç¾…ã€æ¾æ¾ã€Ekkamai é€›è¡—</span>
                            </li>
                        </ul>
                        ), 
                        icon: "users" 
                    },
                    { time: "12:00", title: "è‡ªç”±åˆé¤", desc: "å„è‡ªå°‹æ‰¾å–œæ„›çš„é¤å»³ (12:00-13:00)", icon: "utensils" },
                    { 
                        time: "15:00", 
                        title: "ä¸‹åˆè¡Œç¨‹ (äºŒé¸ä¸€)", 
                        desc: (
                        <ul className="space-y-2 mt-2">
                            <li className="flex gap-2 items-start">
                            <span className="shrink-0 font-bold bg-[#0F1C20] text-[#FF9F68] text-[10px] px-1.5 rounded py-0.5 mt-0.5">A</span>
                            <span>Siam å•†åœˆ (Siam Square â” CentralWorld)</span>
                            </li>
                            <li className="flex gap-2 items-start">
                            <span className="shrink-0 font-bold bg-[#0F1C20] text-[#FF9F68] text-[10px] px-1.5 rounded py-0.5 mt-0.5">B</span>
                            <span>å›é£¯åº—ä¼‘æ¯ æˆ– æ‰¾å’–å•¡å»³æ”¾é¬†</span>
                            </li>
                        </ul>
                        ), 
                        icon: "map" 
                    },
                    { time: "17:30", title: "æ™šé¤ Inter Restaurants", desc: "ç¾å ´æ’éšŠï¼Œäº«ç”¨é“åœ°æ³°èœï¼Œåƒå®Œç¹¼çºŒé€›", icon: "utensils", link: "https://maps.app.goo.gl/hn1eX6SR5QDjM2L69" },
                    { time: "20:00", title: "æ™šé–“æ´»å‹•", desc: "æŒ‰æ‘© / é…’å§è·¯è·‘ (Bar Us + Dry Wave + Spire) / BigC", icon: "moon" }
                ]
            },
            '3/2': {
                title: "Home Sweet Home",
                desc: "Last Shopping & Departure",
                icon: <Plane size={20} />,
                events: [
                    { time: "06:30", title: "é£¯åº—æ—©é¤", desc: "ä¾›æ‡‰æ™‚é–“è‡³ 10:30", icon: "coffee" },
                    { 
                        time: "10:00", 
                        title: "ç¬¬ä¸€æ¢¯æ¬¡ (JX742)", 
                        desc: (
                        <div className="space-y-1 mt-1 text-sm border-l-2 border-[#FF9F68] pl-2">
                            <p>â€¢ 10:00 é£¯åº—å‡ºç™¼å‰å¾€æ©Ÿå ´</p>
                            <p>â€¢ 13:45 <strong>JX742</strong> è¿”å›å°åŒ—</p>
                        </div>
                        ), 
                        icon: "plane" 
                    },
                    { 
                        time: "09:30", 
                        title: "ç¬¬äºŒæ¢¯æ¬¡ (JX746)", 
                        desc: (
                        <div className="space-y-2 mt-1 text-sm border-l-2 border-[#0F1C20] pl-2">
                            <p>â€¢ 09:30 Central Park æœ€å¾Œè¡€æ‹¼</p>
                            <p>â€¢ 12:30 åˆé¤ <strong className="cursor-pointer hover:text-[#FF9F68] underline">Aunglo by Yangrak</strong></p>
                            <p>â€¢ 14:00 é£¯åº—å‡ºç™¼å‰å¾€æ©Ÿå ´</p>
                            <p>â€¢ 17:40 <strong>JX746</strong> è¿”å›å°åŒ—</p>
                        </div>
                        ), 
                        icon: "shopping-bag",
                        link: "https://maps.app.goo.gl/mn17o6roHwB87Cdy8"
                    }
                ]
            },
        };

        const ROOM_DATA = [
            { id: 1, hotelKey: 'huahin', type: "Standard King Room", name: "Tang", beds: "1 King Bed", guests: "1 Pax", icon: "bed_double" },
            { id: 2, hotelKey: 'huahin', type: "Standard Twin Room", name: "å“è¬™", beds: "2 Double Beds", guests: "1 Pax", icon: "users" },
            { id: 3, hotelKey: 'huahin', type: "Standard Twin Room", name: "chen + é®ªé­š", beds: "2 Double Beds", guests: "2 Pax", icon: "users" },
            { id: 4, hotelKey: 'huahin', type: "Standard Twin Room", name: "é’é’ + å‰", beds: "2 Double Beds", guests: "2 Pax", icon: "users" },
            { id: 5, hotelKey: 'huahin', type: "Standard Twin Room", name: "ç® + ç‹å…«å…«", beds: "2 Double Beds", guests: "2 Pax", icon: "users" },
            { id: 6, hotelKey: 'huahin', type: "Standard Twin Room", name: "èœœè‰ + ä¸€æ¶µ", beds: "2 Double Beds", guests: "2 Pax", icon: "users" },
            { id: 7, hotelKey: 'huahin', type: "Standard Twin Room", name: "Yeeã€é–æ¦†ã€ã„“", beds: "2 Double Beds", guests: "3 Pax", icon: "users" },
            { id: 1, hotelKey: 'asai', type: "Comfy Twin Room", name: "å“è¬™ + ç‹å…«å…«", beds: "2 Single Beds", guests: "2 Pax", icon: "users" },
            { id: 2, hotelKey: 'asai', type: "Comfy Twin Room", name: "chen + é’é’", beds: "2 Single Beds", guests: "2 Pax", icon: "users" },
            { id: 3, hotelKey: 'asai', type: "Comfy Twin Room", name: "ç® + å‰", beds: "2 Single Beds", guests: "2 Pax", icon: "users" },
            { id: 4, hotelKey: 'asai', type: "Comfy Twin Room", name: "ã„“ + é®ªé­š", beds: "2 Single Beds", guests: "2 Pax", icon: "users" },
            { id: 5, hotelKey: 'asai', type: "Comfy Twin Room", name: "èœœè‰ + ä¸€æ¶µ", beds: "2 Single Beds", guests: "2 Pax", icon: "users" },
            { id: 6, hotelKey: 'asai', type: "Roomy Triple Room", name: "Tangã€Yeeã€é–æ¦†", beds: "2 Single + 1 Bunk", guests: "3 Pax", icon: "users" },
        ];

        const FLIGHT_DATA = [
            {
                type: 'å»ç¨‹ Departure',
                airline: 'Thai Lion Air',
                logo: 'https://dej5dgk6v2ulk.cloudfront.net/Web/resource/images/Lion_Air.svg',
                flightNum: 'SL395',
                date: '2026.02.25',
                origin: 'TPE',
                dest: 'DMK',
                scheduledDep: '21:15',
                scheduledArr: '00:15',
                duration: '04h 00m',
                meetingTime: '19:45',
                note: 'No Online Check-in available.',
                noCheckIn: true,
                arrivalNextDay: true
            },
            {
                type: 'å›ç¨‹ Return (G1)',
                airline: 'Starlux',
                logo: 'https://logosandtypes.com/wp-content/uploads/2025/06/starlux-airlines.svg',
                flightNum: 'JX742',
                date: '2026.03.02',
                origin: 'BKK',
                dest: 'TPE',
                scheduledDep: '13:45',
                scheduledArr: '18:30', 
                duration: '03h 45m', 
                meetingTime: '10:00',
                note: 'Group 1 Departure (Hotel -> Airport)',
                arrivalNextDay: false
            },
            {
                type: 'å›ç¨‹ Return (G2)',
                airline: 'Starlux',
                logo: 'https://logosandtypes.com/wp-content/uploads/2025/06/starlux-airlines.svg',
                flightNum: 'JX746',
                date: '2026.03.02',
                origin: 'BKK',
                dest: 'TPE',
                scheduledDep: '17:40',
                scheduledArr: '22:20', 
                duration: '03h 40m', 
                meetingTime: '14:00',
                note: 'Group 2 Departure (Hotel -> Airport)',
                arrivalNextDay: false
            }
        ];

        // Fallback data in case API fails
        const FALLBACK_WEATHER = {
            current: { weather_code: 0, temperature_2m: 32, relative_humidity_2m: 60, wind_speed_10m: 12 },
            daily: {
                weather_code: [0, 1, 2, 1, 0, 0],
                temperature_2m_max: [34, 34, 33, 34, 35, 34],
                temperature_2m_min: [26, 26, 25, 26, 26, 26],
                sunrise: ["2026-02-25T06:30"],
                sunset: ["2026-02-25T18:30"],
                time: ["2026-02-25", "2026-02-26", "2026-02-27", "2026-02-28", "2026-03-01", "2026-03-02"]
            }
        };

        // Custom Hook for Countdown
        const useCountdown = (targetDate) => {
            const [timeLeft, setTimeLeft] = useState({ days: 0, hours: 0, minutes: 0, seconds: 0 });

            const calculateTimeLeft = () => {
                const difference = +new Date(targetDate) - +new Date();
                let timeLeft = {};

                if (difference > 0) {
                    timeLeft = {
                        days: Math.floor(difference / (1000 * 60 * 60 * 24)),
                        hours: Math.floor((difference / (1000 * 60 * 60)) % 24),
                        minutes: Math.floor((difference / 1000 / 60) % 60),
                        seconds: Math.floor((difference / 1000) % 60),
                    };
                } else {
                    timeLeft = { days: 0, hours: 0, minutes: 0, seconds: 0 };
                }
                return timeLeft;
            };

            useEffect(() => {
                setTimeLeft(calculateTimeLeft());
                const timer = setInterval(() => {
                    setTimeLeft(calculateTimeLeft());
                }, 1000);
                return () => clearInterval(timer);
            }, [targetDate]);

            return timeLeft;
        };

        // --- GEMINI API CALLER ---
        const callGeminiAPI = async (userQuery, systemPrompt, modelName, useSearch = true) => {
            const apiKey = "AIzaSyDCBEhOGfDaUMbnIVMyllMolf47PFej4RE"; 
            // Use modelName in the URL
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                tools: useSearch ? [{ "google_search": {} }] : undefined,
            };

            const maxRetries = 3;
            let delay = 1000;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && i < maxRetries - 1) { 
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2;
                            continue;
                        }
                        throw new Error(`API call failed with status: ${response.status}`);
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "æŠ±æ­‰ï¼ŒAI æš«æ™‚ç„¡æ³•æä¾›ç­”æ¡ˆã€‚";
                    return { text, result };

                } catch (error) {
                    console.error("Gemini API error:", error);
                    if (i === maxRetries - 1) {
                         return { text: "ç„¡æ³•é€£æ¥ AI æœå‹™ã€‚è«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦ã€‚", result: null };
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        };

        // --- Components ---

        const PillNav = ({ activeTab, setActiveTab }) => {
            return (
                <div className="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-[#0F1C20] rounded-full px-2 py-2 flex items-center shadow-2xl z-50 max-w-[95vw] overflow-x-auto no-scrollbar">
                    <button 
                        onClick={() => setActiveTab('home')}
                        className={`flex items-center gap-2 px-4 py-3 rounded-full transition-all duration-300 whitespace-nowrap ${activeTab === 'home' ? 'bg-[#FF9F68] text-[#0F1C20] font-bold' : 'text-gray-400 hover:text-white'}`}
                    >
                        <Home size={20} />
                        {activeTab === 'home' && <span>é¦–é </span>}
                    </button>
                    <button 
                        onClick={() => setActiveTab('schedule')}
                        className={`flex items-center gap-2 px-4 py-3 rounded-full transition-all duration-300 whitespace-nowrap ${activeTab === 'schedule' ? 'bg-[#FF9F68] text-[#0F1C20] font-bold' : 'text-gray-400 hover:text-white'}`}
                    >
                        <Calendar size={20} />
                        {activeTab === 'schedule' && <span>è¡Œç¨‹</span>}
                    </button>
                    <button 
                        onClick={() => setActiveTab('map')}
                        className={`flex items-center gap-2 px-4 py-3 rounded-full transition-all duration-300 whitespace-nowrap ${activeTab === 'map' ? 'bg-[#FF9F68] text-[#0F1C20] font-bold' : 'text-gray-400 hover:text-white'}`}
                    >
                        <MapIcon size={20} />
                        {activeTab === 'map' && <span>åœ°åœ–</span>}
                    </button>
                    <button 
                        onClick={() => setActiveTab('hotels')}
                        className={`flex items-center gap-2 px-4 py-3 rounded-full transition-all duration-300 whitespace-nowrap ${activeTab === 'hotels' || activeTab === 'room_list' ? 'bg-[#FF9F68] text-[#0F1C20] font-bold' : 'text-gray-400 hover:text-white'}`}
                    >
                        <MapPin size={20} />
                        {(activeTab === 'hotels' || activeTab === 'room_list') && <span>ä½å®¿</span>}
                    </button>
                    <button 
                        onClick={() => setActiveTab('notes')}
                        className={`flex items-center gap-2 px-4 py-3 rounded-full transition-all duration-300 whitespace-nowrap ${activeTab === 'notes' ? 'bg-[#FF9F68] text-[#0F1C20] font-bold' : 'text-gray-400 hover:text-white'}`}
                    >
                        <Info size={20} />
                        {activeTab === 'notes' && <span>é ˆçŸ¥</span>}
                    </button>
                    <button 
                        onClick={() => setActiveTab('tickets')}
                        className={`flex items-center gap-2 px-4 py-3 rounded-full transition-all duration-300 whitespace-nowrap ${activeTab === 'tickets' ? 'bg-[#FF9F68] text-[#0F1C20] font-bold' : 'text-gray-400 hover:text-white'}`}
                    >
                        <Plane size={20} />
                        {activeTab === 'tickets' && <span>æ©Ÿç¥¨</span>}
                    </button>
                </div>
            );
        };

        const Header = ({ title, showBack = false, onBack, onOpenChat }) => (
            <div className="flex justify-between items-center py-4 px-2 relative z-50">
                <div className="flex items-center gap-2 min-w-[48px]">
                     {showBack ? (
                        <button 
                            onClick={onBack}
                            className="p-3 bg-white/20 backdrop-blur-sm rounded-full hover:bg-white/30 transition pointer-events-auto"
                        >
                            <ChevronLeft size={24} className="text-[#0F1C20]" />
                        </button>
                    ) : <div className="w-1"></div>}
                </div>
                
                <h1 className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-xl font-bold text-[#0F1C20] tracking-wide whitespace-nowrap pointer-events-none z-40">
                    {title}
                </h1>

                <div className="flex items-center gap-2">
                    <button 
                        onClick={onOpenChat}
                        className="p-3 bg-white/90 backdrop-blur-sm rounded-full hover:bg-white transition shadow-lg pointer-events-auto flex items-center gap-2 group"
                    >
                        <Bot size={24} className="text-[#FF9F68] group-hover:rotate-12 transition-transform" />
                        <span className="text-xs font-bold text-[#0F1C20] pr-1 hidden sm:inline">AI åŠ©ç†</span>
                    </button>
                </div> 
            </div>
        );

        // --- Views ---

        const WeatherCard = () => {
            const [isHuaHin, setIsHuaHin] = useState(false);
            const [weatherBKK, setWeatherBKK] = useState(null);
            const [weatherHH, setWeatherHH] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const fetchWeather = async () => {
                    try {
                        const [bkkRes, hhRes] = await Promise.all([
                            fetch('https://api.open-meteo.com/v1/forecast?latitude=13.7563&longitude=100.5018&current=temperature_2m,relative_humidity_2m,is_day,weather_code,wind_speed_10m&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset&timezone=Asia%2FBangkok'),
                            fetch('https://api.open-meteo.com/v1/forecast?latitude=12.5684&longitude=99.9577&current=temperature_2m,relative_humidity_2m,is_day,weather_code,wind_speed_10m&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset&timezone=Asia%2FBangkok')
                        ]);
                        
                        const bkkData = await bkkRes.json();
                        const hhData = await hhRes.json();
                        
                        setWeatherBKK(bkkData);
                        setWeatherHH(hhData);
                    } catch (error) {
                        console.error("Failed to fetch weather, using fallback", error);
                        setWeatherBKK(FALLBACK_WEATHER);
                        setWeatherHH(FALLBACK_WEATHER);
                    } finally {
                        setLoading(false);
                    }
                };

                fetchWeather();
            }, []);

            const getWeatherIcon = (code, size = 16, className = "") => {
                if (code === 0) return <Sun size={size} className={`text-[#FF9F68] ${className}`} />;
                if (code >= 1 && code <= 3) return <Cloud size={size} className={`text-gray-300 ${className}`} />;
                if (code >= 45 && code <= 48) return <Cloud size={size} className={`text-gray-400 ${className}`} />;
                if (code >= 51 && code <= 67) return <CloudRain size={size} className={`text-blue-300 ${className}`} />;
                if (code >= 80 && code <= 99) return <CloudRain size={size} className={`text-blue-400 ${className}`} />;
                return <Sun size={size} className={`text-[#FF9F68] ${className}`} />;
            };

            if (loading) {
                return (
                    <div className="mx-6 mb-8 rounded-[35px] p-6 bg-[#0F1C20] text-white flex justify-center items-center h-[320px] shadow-xl">
                        <RefreshCcw className="animate-spin text-[#FF9F68]" size={32} />
                    </div>
                );
            }

            const activeWeather = isHuaHin ? (weatherHH || FALLBACK_WEATHER) : (weatherBKK || FALLBACK_WEATHER);
            const locationName = isHuaHin ? "Hua Hin, Thailand" : "Bangkok, Thailand";
            const bgColor = isHuaHin 
                ? "bg-gradient-to-br from-[#c2410c] to-[#ea580c]" 
                : "bg-gradient-to-br from-[#0F1C20]/90 via-[#1a2e33]/85 to-[#2E5C55]/80";
            const contentKey = isHuaHin ? 'hh' : 'bkk';

            const current = activeWeather.current;
            const daily = activeWeather.daily;
            const today = new Date();
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            const formattedDate = `${monthNames[today.getMonth()]} ${today.getFullYear()}`;
            const sunrise = daily.sunrise?.[0]?.split('T')?.[1] || "06:30";
            const sunset = daily.sunset?.[0]?.split('T')?.[1] || "18:30";

            return (
                <div className="mx-6 mb-6 cursor-pointer group" onClick={() => setIsHuaHin(!isHuaHin)}>
                    <div className={`relative rounded-[35px] p-6 text-white overflow-hidden shadow-xl transition-colors duration-500 ${bgColor} flex flex-col justify-between h-[320px]`}>
                        
                        {/* Decorative Glow */}
                        <div className="absolute top-[-50%] left-[-20%] w-[200px] h-[200px] bg-white opacity-10 blur-[80px] rounded-full pointer-events-none z-0"></div>

                        {/* Content Container with Fade In Animation on Key Change */}
                        <div key={contentKey} className="relative z-10 flex flex-col h-full justify-between animate-fade-in">
                            {/* Top Section */}
                            <div className="flex justify-between items-start">
                                <div className="flex items-center gap-4">
                                    {getWeatherIcon(current.weather_code, 52, "drop-shadow-[0_0_15px_rgba(255,159,104,0.5)]")}
                                    <div>
                                        <p className="text-xs font-normal opacity-70 mb-0.5">Current Weather</p>
                                        <h3 className="text-3xl font-bold leading-none">{Math.round(current.temperature_2m)}Â°C</h3>
                                        <p className="text-sm font-bold opacity-90">{locationName}</p>
                                    </div>
                                </div>
                                <div className="text-right">
                                    <span className="text-xs font-bold bg-white/10 px-2 py-1 rounded-lg backdrop-blur-sm">{formattedDate}</span>
                                </div>
                            </div>

                            {/* Middle Pills Section */}
                            <div className="space-y-2">
                                {/* Sun Times Pill */}
                                <div className="bg-black/20 rounded-2xl px-4 py-2 flex justify-between items-center text-xs border border-white/5 shadow-inner">
                                    <div className="flex items-center gap-2 text-white/90">
                                        <Sun size={14} className="text-[#FF9F68]" /> 
                                        <span>{sunrise}</span>
                                    </div>
                                    <div className="flex-1 mx-4 h-[2px] bg-white/10 rounded-full relative">
                                        <div className="absolute left-0 top-0 h-full w-[60%] bg-gradient-to-r from-[#FF9F68] to-transparent opacity-50"></div>
                                    </div>
                                    <div className="flex items-center gap-2 text-white/90">
                                        <span>{sunset}</span>
                                        <Moon size={14} className="text-[#FF9F68]" />
                                    </div>
                                </div>
                                 {/* Humidity Pill */}
                                <div className="bg-black/20 rounded-2xl px-4 py-2 flex items-center justify-between text-xs border border-white/5 shadow-inner">
                                    <div className="flex items-center gap-2">
                                        <CloudRain size={14} className="text-blue-300" />
                                        <span className="font-bold">Humidity</span>
                                    </div>
                                    <span className="font-bold text-blue-200">{current.relative_humidity_2m}%</span>
                                </div>
                            </div>

                            {/* Bottom Details & Forecast */}
                            <div className="flex justify-between items-end pt-2">
                                <div className="flex flex-col gap-1 text-xs opacity-70 pr-4 border-r border-white/10">
                                    <div className="flex items-center gap-1"><Wind size={12}/> {current.wind_speed_10m}km/h</div>
                                </div>

                                <div className="flex-1 flex justify-between pl-4 overflow-x-auto no-scrollbar">
                                    {/* Display next 5 days forecast */}
                                    {daily.time.slice(1, 6).map((time, i) => {
                                        const dateObj = new Date(time);
                                        const dayName = dateObj.toLocaleDateString('en-US', { weekday: 'short' });
                                        const avgTemp = Math.round((daily.temperature_2m_max[i+1] + daily.temperature_2m_min[i+1]) / 2);
                                        return (
                                            <div key={i} className="flex flex-col items-center gap-1.5 min-w-[30px] opacity-90">
                                                <span className="text-[9px] uppercase tracking-wide">{dayName}</span>
                                                {getWeatherIcon(daily.weather_code[i+1], 14)}
                                                <span className="text-[10px]">{avgTemp}Â°</span>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div className="text-center mt-3 flex items-center justify-center gap-2 opacity-60 animate-pulse">
                        <Replace size={12} className="text-[#0F1C20]" />
                        <p className="text-xs text-[#0F1C20] font-bold tracking-wide">
                            {isHuaHin ? "ç›®å‰é¡¯ç¤ºï¼šè¯æ¬£ (é»æ“Šåˆ‡æ›å›æ›¼è°·)" : "ç›®å‰é¡¯ç¤ºï¼šæ›¼è°· (é»æ“Šåˆ‡æ›è‡³è¯æ¬£)"}
                        </p>
                    </div>
                </div>
            );
        };

        const HomeView = ({ setActiveTab }) => {
            const timeLeft = useCountdown('2026-02-25T19:45:00');
            const upcomingDay = '2/25';
            const upcomingData = TRIP_DATA[upcomingDay];
            const nextEvent = upcomingData.events[0]; 

            return (
                <div className="animate-fade-in pb-24">
                    <div className="relative rounded-b-[45px] overflow-hidden shadow-xl mb-8 pt-20">
                         <div className="absolute inset-0 z-0">
                            <img 
                                src="https://www.the-backpacking-site.com/wp-content/uploads/2023/01/visiter-bangkok-1.jpg" 
                                alt="Bangkok Background" 
                                className="w-full h-full object-cover"
                            />
                            <div className="absolute inset-0 bg-white/10"></div> 
                            <div className="absolute inset-0 bg-gradient-to-b from-transparent via-white/20 to-[#C4E0E0]"></div> 
                        </div>

                        <div className="relative z-10 px-6 pb-8">
                            <div className="mb-6">
                                <h2 className="text-4xl font-bold text-[#0F1C20] leading-tight mb-2 drop-shadow-sm">
                                    æ³°æ³°æ³°æ³°è¾£è¾£ğŸ¥µ
                                </h2>
                                <div className="flex items-center gap-2 text-[#0F1C20] mt-2 font-bold bg-white/30 w-fit px-3 py-1 rounded-full backdrop-blur-md">
                                    <Users size={18} />
                                    <span>13 äºº</span>
                                    <span className="mx-2">â€¢</span>
                                    <span>2026.02.25 - 03.02</span>
                                </div>
                            </div>

                            <div className="bg-[#0F1C20] rounded-[30px] p-6 text-white shadow-2xl relative overflow-hidden">
                                <div className="absolute top-0 right-0 w-32 h-32 bg-[#FF9F68] rounded-full filter blur-[60px] opacity-20"></div>
                                <h3 className="text-lg text-gray-400 mb-4">è·é›¢æ¡ƒåœ’æ©Ÿå ´é›†åˆé‚„æœ‰</h3>
                                <div className="flex justify-between items-end">
                                    <div className="text-center flex-1">
                                        <span className="text-2xl sm:text-3xl font-bold text-[#FF9F68]">{timeLeft.days || 0}</span>
                                        <p className="text-[10px] sm:text-xs text-gray-500 uppercase tracking-wider mt-1 font-normal">Days</p>
                                    </div>
                                    <div className="text-xl sm:text-2xl font-normal text-gray-600 mb-4">:</div>
                                    <div className="text-center flex-1">
                                        <span className="text-2xl sm:text-3xl font-bold text-white">{timeLeft.hours || 0}</span>
                                        <p className="text-[10px] sm:text-xs text-gray-500 uppercase tracking-wider mt-1 font-normal">Hrs</p>
                                    </div>
                                    <div className="text-xl sm:text-2xl font-normal text-gray-600 mb-4">:</div>
                                    <div className="text-center flex-1">
                                        <span className="text-2xl sm:text-3xl font-bold text-white">{timeLeft.minutes || 0}</span>
                                        <p className="text-[10px] sm:text-xs text-gray-500 uppercase tracking-wider mt-1 font-normal">Mins</p>
                                    </div>
                                    <div className="text-xl sm:text-2xl font-normal text-gray-600 mb-4">:</div>
                                    <div className="text-center flex-1">
                                        <span className="text-2xl sm:text-3xl font-bold text-[#FF9F68] w-8 inline-block text-center tabular-nums">
                                            {String(timeLeft.seconds || 0).padStart(2, '0')}
                                        </span>
                                        <p className="text-[10px] sm:text-xs text-gray-500 uppercase tracking-wider mt-1 font-normal">Secs</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <WeatherCard />

                    <div className="mb-4 px-6">
                        <div className="flex justify-between items-end mb-4">
                            <h3 className="text-xl font-bold text-[#0F1C20]">è¡Œç¨‹é è¦½ (Up Next)</h3>
                            <span 
                                onClick={() => setActiveTab('schedule')} 
                                className="text-sm text-[#FF9F68] font-bold cursor-pointer flex items-center gap-1"
                            >
                                Full Schedule <ArrowRight size={14}/>
                            </span>
                        </div>

                        <div 
                            onClick={() => setActiveTab('schedule')}
                            className="bg-white rounded-[30px] p-6 shadow-lg border border-gray-100 relative overflow-hidden group cursor-pointer hover:shadow-xl transition-all"
                        >
                            <div className="absolute top-0 right-0 w-24 h-24 bg-[#C4E0E0] rounded-full blur-[40px] opacity-50 group-hover:opacity-80 transition-opacity"></div>
                            
                            <div className="relative z-10">
                                <div className="flex items-center justify-between mb-4">
                                    <div className="flex items-center gap-2">
                                        <span className="bg-[#FF9F68] text-[#0F1C20] text-xs font-bold px-2 py-1 rounded-lg">
                                            Day 1 â€¢ {upcomingDay}
                                        </span>
                                        <span className="text-gray-400 text-xs font-normal">Starting Soon</span>
                                    </div>
                                    <div className="bg-[#0F1C20] p-2 rounded-full text-white">
                                        {upcomingData.icon}
                                    </div>
                                </div>

                                <h2 className="text-2xl font-bold text-[#0F1C20] mb-1">{upcomingData.title}</h2>
                                <p className="text-gray-500 text-sm mb-6 font-normal">{upcomingData.desc}</p>

                                <div className="bg-[#F5F7F7] rounded-2xl p-4 flex items-start gap-4">
                                    <div className="bg-white w-12 h-12 rounded-xl flex flex-col items-center justify-center shadow-sm shrink-0 border border-gray-100">
                                        <span className="text-[10px] text-gray-400 font-bold">TIME</span>
                                        <span className="text-[#0F1C20] font-bold">{nextEvent.time}</span>
                                    </div>
                                    <div className="flex-1">
                                        <h4 className="text-[#0F1C20] font-bold text-sm">{nextEvent.title}</h4>
                                        <p className="text-gray-500 text-xs mt-1 line-clamp-2 font-normal">{nextEvent.desc}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const ScheduleView = () => {
            const [selectedDay, setSelectedDay] = useState('2/25');
            const [touchStart, setTouchStart] = useState(0);
            const [touchEnd, setTouchEnd] = useState(0);

            const days = [
                { date: '2/25', day: 'Wed', active: selectedDay === '2/25' },
                { date: '2/26', day: 'Thu', active: selectedDay === '2/26' },
                { date: '2/27', day: 'Fri', active: selectedDay === '2/27' },
                { date: '2/28', day: 'Sat', active: selectedDay === '2/28' },
                { date: '3/1', day: 'Sun', active: selectedDay === '3/1' },
                { date: '3/2', day: 'Mon', active: selectedDay === '3/2' },
            ];

            const handleTouchStart = (e) => {
                setTouchStart(e.targetTouches[0].clientX);
                setTouchEnd(0);
            };

            const handleTouchMove = (e) => {
                setTouchEnd(e.targetTouches[0].clientX);
            };

            const handleTouchEnd = () => {
                if (touchEnd === 0) return;
                const distance = touchStart - touchEnd;
                const swipeThreshold = 50; 

                if (Math.abs(distance) < swipeThreshold) return;

                const isLeftSwipe = distance > 0;
                const currentIndex = days.findIndex(d => d.date === selectedDay);
                let newIndex = currentIndex;

                if (isLeftSwipe && currentIndex < days.length - 1) {
                    newIndex = currentIndex + 1; // Swipe left (next day)
                } else if (!isLeftSwipe && currentIndex > 0) {
                    newIndex = currentIndex - 1; // Swipe right (previous day)
                }

                if (newIndex !== currentIndex) {
                    setSelectedDay(days[newIndex].date);
                }
            };
            
            const currentData = TRIP_DATA[selectedDay] || { title: "Coming Soon", desc: "", events: [] };

            return (
                <div className="animate-fade-in px-6 pb-24 pt-24">
                    <h2 className="text-3xl font-bold text-[#0F1C20] mb-6">è¡Œç¨‹</h2>
                    
                    {/* Day Selection Pills */}
                    <div className="flex gap-3 overflow-x-auto pb-6 no-scrollbar">
                        {days.map((item, idx) => (
                            <div 
                                key={idx} 
                                onClick={() => setSelectedDay(item.date)}
                                className={`flex flex-col items-center justify-center min-w-[70px] h-[90px] rounded-[24px] border transition-all cursor-pointer ${item.active ? 'bg-[#0F1C20] text-white border-[#0F1C20]' : 'bg-white border-transparent text-gray-400'}`}
                            >
                                <span className="text-xs font-normal mb-1">{item.day}</span>
                                <span className="text-xl font-bold">{item.date}</span>
                            </div>
                        ))}
                    </div>

                    {/* Timeline Card - Swipe Area */}
                    <div 
                        className="space-y-4"
                        onTouchStart={handleTouchStart}
                        onTouchMove={handleTouchMove}
                        onTouchEnd={handleTouchEnd}
                    >
                        <div 
                            key={selectedDay} // Key change triggers content animation
                            className="bg-[#FF9F68] rounded-[30px] p-6 text-[#0F1C20] relative overflow-hidden min-h-[400px] animate-fade-in"
                        >
                            <div className="absolute -right-4 -top-4 w-24 h-24 bg-white/20 rounded-full blur-xl"></div>
                            
                            <div className="flex justify-between items-start mb-8 relative z-10">
                                <div>
                                    <p className="font-bold opacity-70">{currentData.desc}</p>
                                    <h3 className="text-2xl font-bold mt-1">{currentData.title}</h3>
                                </div>
                                <div className="bg-[#0F1C20] w-12 h-12 rounded-full flex items-center justify-center text-white">
                                    {currentData.icon}
                                </div>
                            </div>
                            
                            <div className="space-y-6 relative z-10">
                                {currentData.events.map((event, idx) => (
                                    <div key={idx} className="flex gap-4 items-start group">
                                        <div className="w-14 font-bold text-right shrink-0 pt-1">{event.time}</div>
                                        <div className={`flex-1 pb-4 ${idx !== currentData.events.length - 1 ? 'border-l-2 border-[#0F1C20]/20' : ''} pl-4 relative`}>
                                            <div className={`absolute -left-[9px] top-1 w-4 h-4 rounded-full ${idx === 0 ? 'bg-[#0F1C20]' : 'bg-white border-2 border-[#0F1C20]'}`}></div>
                                            <h4 className="font-bold text-lg leading-tight">{event.title}</h4>
                                            <div className="text-sm opacity-80 mt-1 font-normal">{event.desc}</div>
                                            {event.link && (
                                                <a href={event.link} target="_blank" rel="noopener noreferrer" className="inline-flex items-center gap-1 mt-2 text-xs font-bold bg-white/30 px-2 py-1 rounded-full hover:bg-white/50 transition-colors">
                                                    Open Map <ArrowRight size={10} />
                                                </a>
                                            )}
                                        </div>
                                    </div>
                                ))}
                                
                                {currentData.events.length === 0 && (
                                    <div className="text-center opacity-60 py-10">
                                        å°šæœªæ›´æ–°è©³ç´°è¡Œç¨‹
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const RoomAllocationView = ({ hotel }) => {
            const rooms = ROOM_DATA;
            let hotelName = "The Standard Hua Hin";
            let hotelGuests = "Total 7 Rooms â€¢ 13 Guests";
            let headerColor = "bg-[#FF9F68]";

            if (hotel === 'asai') {
                hotelName = "ASAI Bangkok Chinatown";
                headerColor = "bg-[#C4E0E0]"; 
                hotelGuests = "Total 6 Rooms â€¢ 13 Guests";
            }
            
            const filteredRooms = rooms.filter(r => r.hotelKey === hotel);

            return (
                <div className="animate-fade-in px-6 pb-24 pt-24">
                    <div className="flex justify-between items-end mb-6">
                        <h2 className="text-3xl font-bold text-[#0F1C20] leading-none">
                            Room <br/> Allocation List
                        </h2>
                        <div className="p-3 border border-gray-300 rounded-full">
                            <Key size={20} className="text-[#0F1C20]"/>
                        </div>
                    </div>

                    <div className={`${headerColor} rounded-2xl p-4 mb-6 shadow-sm`}>
                        <h3 className="font-bold text-[#0F1C20] flex items-center gap-2">
                            <Home size={18} /> {hotelName}
                        </h3>
                        <p className="text-[#0F1C20]/80 text-sm mt-1 font-normal">{hotelGuests}</p>
                    </div>

                    <div className="space-y-3">
                        {filteredRooms.map((room, idx) => (
                            <div key={idx} className="bg-white rounded-[24px] p-5 flex items-center gap-4 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                                <div className="w-12 h-12 rounded-full bg-[#F5F7F7] flex items-center justify-center text-[#0F1C20] shrink-0">
                                    {room.icon === 'bed_double' ? <BedDouble size={24} /> : <Users size={24} />}
                                </div>
                                <div className="flex-1">
                                    <div className="flex justify-between items-center mb-1">
                                        <h4 className="font-bold text-[#0F1C20]">Room {room.id}</h4>
                                        <span className={`text-[10px] font-bold px-2 py-1 rounded-full ${room.id === 1 && hotel !== 'asai' ? 'bg-[#0F1C20] text-white' : 'bg-[#FF9F68]/20 text-[#FF9F68]'}`}>
                                            {room.type.includes('King') || room.type.includes('Triple') ? (room.type.includes('Triple') ? 'Triple' : 'King') : 'Twin'}
                                        </span>
                                    </div>
                                    <p className="text-sm text-gray-600 font-bold">{room.name}</p>
                                    <p className="text-xs text-gray-400 mt-0.5 font-normal">{room.beds} â€¢ {room.guests}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const HotelsView = ({ onViewRooms }) => {
            const openMap = (hotelName) => {
                const query = encodeURIComponent(hotelName);
                window.open(`https://www.google.com/maps/search/?api=1&query=${query}`, '_blank');
            };

            return (
                <div className="animate-fade-in px-6 pb-24 pt-24">
                    <div className="flex justify-between items-end mb-6">
                        <h2 className="text-3xl font-bold text-[#0F1C20] leading-none">
                            Your <br/> Hotels
                        </h2>
                        <div className="p-3 border border-gray-300 rounded-full">
                            <MapPin size={20} className="text-[#0F1C20]"/>
                        </div>
                    </div>

                    <div className="mb-6">
                        <div 
                            onClick={() => openMap("SHIN Patara Living Hotel Bangkok")}
                            className="bg-[#FF9F68] rounded-[24px] p-5 flex justify-between items-center cursor-pointer transition hover:bg-[#ff8a50] hover:shadow-md"
                        >
                            <div>
                                <div className="flex items-center gap-2 mb-1">
                                    <span className="bg-[#0F1C20] text-white text-[10px] px-2 py-0.5 rounded-full">Stop 1 â€¢ Arrival</span>
                                </div>
                                <h4 className="font-bold text-[#0F1C20] text-lg">SHIN Patara Living</h4>
                                <p className="text-[#0F1C20]/70 text-sm font-normal">Feb 26 (01:15 AM check-in)</p>
                            </div>
                            <MapIcon size={20} className="text-[#0F1C20]" />
                        </div>
                    </div>

                    <div 
                        className="w-full aspect-[4/5] rounded-[40px] bg-[#0F1C20] relative mb-6 overflow-hidden group hover:shadow-xl transition-all"
                    >
                        <div 
                            onClick={() => openMap("The Standard Hua Hin")}
                            className="absolute inset-0 cursor-pointer"
                        >
                            <img 
                                src="https://assets.hyatt.com/content/dam/hyatt/hyattdam/images/2025/05/16/1025/HUASH-P0016-Pool.jpg/HUASH-P0016-Pool.16x9.jpg" 
                                alt="The Standard Hua Hin Pool" 
                                className="w-full h-full object-cover opacity-80 transition-transform duration-500 group-hover:scale-105" 
                            />
                            <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"></div>
                        </div>
                        
                        <div className="absolute top-6 left-6 right-6 flex justify-between items-start z-10 pointer-events-none">
                            <div>
                                <div className="flex items-center gap-2 mb-1">
                                    <span className="bg-[#C4E0E0] text-[#0F1C20] text-[10px] font-bold px-2 py-0.5 rounded-full">Stop 2</span>
                                </div>
                                <h3 className="text-3xl font-bold text-white leading-tight drop-shadow-lg">The Standard<br/>Hua Hin</h3>
                                <p className="text-white/90 font-medium drop-shadow-md">Feb 26 - 28</p>
                            </div>
                            <button className="w-12 h-12 bg-[#C4E0E0]/90 backdrop-blur rounded-full flex items-center justify-center text-[#0F1C20] shadow-lg pointer-events-auto">
                                <MapIcon size={20} />
                            </button>
                        </div>

                        <div className="absolute bottom-6 left-6 right-6 z-10 flex gap-2">
                            <button 
                                onClick={(e) => {
                                    e.stopPropagation(); 
                                    onViewRooms('huahin');
                                }}
                                className="flex-1 bg-white text-[#0F1C20] font-bold py-4 rounded-[20px] shadow-lg hover:bg-gray-50 transition-colors flex items-center justify-center gap-2"
                            >
                                <Key size={18} />
                                æŸ¥çœ‹åˆ†æˆ¿
                            </button>
                        </div>
                    </div>

                    <div 
                        className="w-full aspect-[4/5] rounded-[40px] bg-[#0F1C20] relative mb-6 overflow-hidden group hover:shadow-xl transition-all"
                    >
                        <div 
                            onClick={() => openMap("ASAI Bangkok Chinatown")}
                            className="absolute inset-0 cursor-pointer"
                        >
                            <div className="w-full h-full bg-gray-800 relative">
                                <img 
                                    src="https://www.dusit.com/asai-bangkok-chinatown/wp-content/uploads/sites/51/cache/2025/03/ABCT-WEBSITE-2/573589606.jpg" 
                                    onError={(e) => {e.target.src = "/api/placeholder/400/500"; e.target.style.opacity="0.5"}}
                                    alt="ASAI Chinatown" 
                                    className="w-full h-full object-cover opacity-80 transition-transform duration-500 group-hover:scale-105" 
                                />
                            </div>
                            <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"></div>
                        </div>
                        
                        <div className="absolute top-6 left-6 right-6 flex justify-between items-start z-10 pointer-events-none">
                            <div>
                                <div className="flex items-center gap-2 mb-1">
                                    <span className="bg-[#FF9F68] text-[#0F1C20] text-[10px] font-bold px-2 py-0.5 rounded-full">Stop 3</span>
                                </div>
                                <h3 className="text-3xl font-bold text-white leading-tight drop-shadow-lg">ASAI<br/>Chinatown</h3>
                                <p className="text-white/90 font-medium drop-shadow-md">Feb 28 - Mar 2</p>
                            </div>
                            <button className="w-12 h-12 bg-[#FF9F68]/90 backdrop-blur rounded-full flex items-center justify-center text-[#0F1C20] shadow-lg pointer-events-auto">
                                <MapIcon size={20} />
                            </button>
                        </div>

                        <div className="absolute bottom-6 left-6 right-6 z-10 flex gap-2">
                            <button 
                                onClick={(e) => {
                                    e.stopPropagation(); 
                                    onViewRooms('asai');
                                }}
                                className="flex-1 bg-white text-[#0F1C20] font-bold py-4 rounded-[20px] shadow-lg hover:bg-gray-50 transition-colors flex items-center justify-center gap-2"
                            >
                                <Key size={18} />
                                æŸ¥çœ‹åˆ†æˆ¿
                            </button>
                        </div>
                    </div>

                </div>
            );
        };

        const FlightTicket = ({ flight, defaultExpanded }) => {
            const [isExpanded, setIsExpanded] = useState(defaultExpanded);
            const [flightStatus, setFlightStatus] = useState({
                status: 'Scheduled',
                gate: 'TBA',
                terminal: '1',
                estimatedDep: flight.scheduledDep,
                estimatedArr: flight.scheduledArr,
                lastUpdated: null,
                loading: false,
                isRealData: false,
                error: null,
                model: '',
                manufacturer: '',
                baggage: '-'
            });

            const fetchFlightData = async () => {
                if (!flight.flightNum) return;
                
                setFlightStatus(prev => ({ ...prev, loading: true, error: null }));
                
                const API_KEY = '3f8352e5-12ae-4c99-86ba-7d451ec11900';
                const FLIGHT_IATA = flight.flightNum;
                const DEP_IATA = flight.origin;
                const ARR_IATA = flight.dest;

                try {
                    // Add dep_iata and arr_iata to filter for specific leg
                    const response = await fetch(`https://airlabs.co/api/v9/flight?flight_iata=${FLIGHT_IATA}&dep_iata=${DEP_IATA}&arr_iata=${ARR_IATA}&api_key=${API_KEY}`);
                    
                    if (!response.ok) {
                        throw new Error('API Response not ok');
                    }

                    const data = await response.json();
                    
                    const now = new Date();
                    const updatedTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

                    if (data.response && data.response.length > 0) {
                        // The API should filter, but double check just in case or if we removed params
                        const flightData = data.response[0]; 
                        
                        let uiStatus = 'Scheduled';
                        if (flightData.status === 'en-route' || flightData.status === 'active') uiStatus = 'On Time';
                        if (flightData.status === 'landed') uiStatus = 'Arrived';
                        if (flightData.status === 'scheduled') uiStatus = 'Scheduled';
                        if (flightData.status === 'cancelled') uiStatus = 'Cancelled';
                        if (flightData.dep_delayed > 15) uiStatus = 'Delayed';

                        let estDep = flightData.dep_estimated || flightData.dep_time || flight.scheduledDep;
                        if (estDep.includes(' ')) estDep = estDep.split(' ')[1].substring(0, 5);

                        let estArr = flightData.arr_estimated || flightData.arr_time || flight.scheduledArr;
                        if (estArr.includes(' ')) estArr = estArr.split(' ')[1].substring(0, 5);

                        setFlightStatus({
                            status: uiStatus,
                            gate: flightData.dep_gate || 'TBA',
                            terminal: flightData.dep_terminal || '1',
                            estimatedDep: estDep,
                            estimatedArr: estArr,
                            lastUpdated: updatedTime,
                            loading: false,
                            isRealData: true,
                            error: null,
                            model: flightData.aircraft_model || '',
                            manufacturer: flightData.aircraft_manufacturer || '',
                            baggage: flightData.arr_baggage || '-'
                        });
                    } else {
                        setFlightStatus(prev => ({
                            ...prev,
                            lastUpdated: updatedTime,
                            loading: false,
                            isRealData: false, 
                            error: "Flight not active"
                        }));
                    }

                } catch (err) {
                    console.error("AirLabs fetch error:", err);
                    const now = new Date();
                    const updatedTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                    setFlightStatus(prev => ({
                        ...prev,
                        lastUpdated: updatedTime,
                        loading: false,
                        isRealData: false,
                        error: "Connection failed"
                    }));
                }
            };

            useEffect(() => {
                fetchFlightData();
            }, []);

            const getStatusColor = (status) => {
                switch(status) {
                    case 'On Time': return 'text-green-500';
                    case 'Arrived': return 'text-green-600';
                    case 'Delayed': return 'text-red-500';
                    case 'Cancelled': return 'text-red-600';
                    case 'Boarding': return 'text-[#FF9F68] animate-pulse';
                    default: return 'text-white';
                }
            };

            return (
                <div className="bg-white rounded-[35px] overflow-hidden shadow-xl flex flex-col relative w-full max-w-md mx-auto transition-all duration-300">
                    <div 
                        onClick={() => setIsExpanded(!isExpanded)}
                        className={`bg-[#0F1C20] p-8 text-white relative cursor-pointer transition-all duration-300 ${!isExpanded ? 'pb-8' : ''}`}
                    >
                        <div className="flex justify-between items-start mb-6">
                            <span className="text-[#FF9F68] font-bold text-sm tracking-wider uppercase border border-[#FF9F68] px-2 py-0.5 rounded-full">
                                {flight.type}
                            </span>
                            
                            <div className="flex flex-col items-end gap-3">
                                <div className="flex gap-3 items-center">
                                    <button 
                                        onClick={(e) => { e.stopPropagation(); fetchFlightData(); }}
                                        className={`p-1.5 rounded-full bg-white/20 hover:bg-white text-white hover:text-[#0F1C20] transition-all ${flightStatus.loading ? 'animate-spin' : ''}`}
                                    >
                                        <RefreshCcw size={14} />
                                    </button>
                                    {isExpanded ? <ChevronUp className="text-gray-400" /> : <ChevronDown className="text-gray-400" />}
                                </div>

                                {isExpanded && (
                                    <div className="flex items-center gap-2 bg-black/30 px-3 py-1 rounded-full backdrop-blur-sm border border-white/10">
                                        <div className={`w-2 h-2 rounded-full ${flightStatus.isRealData ? 'bg-green-500' : 'bg-gray-400'} ${flightStatus.isRealData ? 'animate-pulse' : ''} shadow-[0_0_8px_rgba(34,197,94,0.6)]`}></div>
                                        <span className="text-[10px] font-bold tracking-wider uppercase whitespace-nowrap">
                                            {flightStatus.isRealData ? 'Live' : 'Scheduled'}
                                        </span>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="flex justify-between items-start mb-4 mt-2">
                            <div>
                                <p className="text-gray-400 text-xs font-bold uppercase tracking-widest mb-1">Airline</p>
                                {flight.logo && (
                                    <div className="h-6 mb-2">
                                        <img 
                                            src={flight.logo} 
                                            alt={flight.airline} 
                                            className="h-full object-contain object-left bg-white/90 rounded px-1 py-0.5"
                                        />
                                    </div>
                                )}
                                <p className="text-xl font-bold text-[#FF9F68]">{flight.airline}</p>
                                {/* Aircraft Info - Forced Display */}
                                <p className="text-gray-400 text-[10px] mt-1 font-normal">
                                    {flightStatus.isRealData && flightStatus.model 
                                        ? `${flightStatus.manufacturer} ${flightStatus.model}`
                                        : (flight.airline === 'Starlux' ? 'Airbus A330-900neo' : 'Boeing 737-800')}
                                </p>
                            </div>
                            <div className="text-right"> 
                                <p className="text-gray-400 text-xs font-bold uppercase tracking-widest mb-1">Flight</p>
                                <p className="text-3xl font-bold">{flight.flightNum}</p>
                            </div>
                        </div>

                        <div className="flex justify-between items-center mb-4">
                            <div className="text-xs text-gray-400 font-normal">{flight.date}</div>
                            <div className={`text-sm font-bold ${getStatusColor(flightStatus.status)} flex items-center gap-1`}>
                                {flightStatus.status}
                                {(flightStatus.status === 'On Time' || flightStatus.status === 'Arrived') && <CheckSquare size={12} />}
                            </div>
                            <div className="text-xs text-gray-400 font-normal">{flight.duration}</div>
                        </div>
                        
                        <div className="flex items-center justify-between relative mb-2">
                            <div className="w-3 h-3 bg-[#FF9F68] rounded-full z-10"></div>
                            <div className="h-[2px] bg-gray-700 w-full absolute top-1/2 left-0"></div>
                            <div className="w-3 h-3 bg-[#FF9F68] rounded-full z-10"></div>
                        </div>

                        <div className="flex justify-between text-lg font-bold tracking-wide">
                            <span>{flight.origin}</span>
                            <span>{flight.dest}</span>
                        </div>
                        
                        <div className="flex justify-between text-xs text-gray-400 mt-1">
                            <div>
                                <span className="block text-gray-500 mb-1 font-normal">{isExpanded ? 'Scheduled' : 'Departs'}</span>
                                <span className="text-white font-bold text-sm">{flightStatus.estimatedDep}</span>
                            </div>
                            <div className="text-right">
                                <span className="block text-gray-500 mb-1 font-normal">{isExpanded ? 'Estimated' : 'Arrives'}</span>
                                <span className={`text-sm font-bold ${flightStatus.status === 'Delayed' ? 'text-red-400' : 'text-white'}`}>
                                    {flightStatus.estimatedArr}{flight.arrivalNextDay ? ' (+1)' : ''}
                                </span>
                            </div>
                        </div>

                        {isExpanded && (
                            <>
                                <div className="absolute -bottom-4 -left-4 w-8 h-8 bg-[#C4E0E0] rounded-full z-20"></div>
                                <div className="absolute -bottom-4 -right-4 w-8 h-8 bg-[#C4E0E0] rounded-full z-20"></div>
                            </>
                        )}
                    </div>

                    <div className={`transition-all duration-300 ease-in-out overflow-hidden ${isExpanded ? 'max-h-[1200px] opacity-100' : 'max-h-0 opacity-0'}`}>
                        <div className="h-8 bg-white relative flex items-center justify-center">
                            <div className="w-[90%] border-t-2 border-dashed border-gray-300"></div>
                        </div>

                        <div className="bg-white p-8 pt-2">
                            <div className="grid grid-cols-3 gap-4 mb-6">
                                <div>
                                    <p className="text-gray-400 text-xs font-bold uppercase mb-1">Terminal</p>
                                    <p className="text-[#0F1C20] font-bold text-lg">{flightStatus.terminal}</p>
                                </div>
                                <div className="text-center">
                                    <p className="text-gray-400 text-xs font-bold uppercase mb-1">Gate</p>
                                    <p className="text-[#0F1C20] font-bold text-2xl animate-pulse text-indigo-600">
                                        {flightStatus.loading ? '...' : flightStatus.gate}
                                    </p>
                                </div>
                                <div className="text-right">
                                    <p className="text-gray-400 text-xs font-bold uppercase mb-1">Meeting</p>
                                    <p className="text-red-500 font-bold text-lg">{flight.meetingTime}</p>
                                </div>
                            </div>

                            {/* Baggage Info - Forced Display */}
                            <div className="flex justify-between items-center mb-4 pb-4 border-b border-gray-100">
                                    <div className="flex items-center gap-2">
                                    <Luggage size={16} className="text-gray-400" />
                                    <p className="text-xs font-bold text-gray-500 uppercase">è¡Œæè½‰ç›¤</p>
                                    </div>
                                    <p className="text-[#0F1C20] font-bold text-lg">{flightStatus.isRealData ? flightStatus.baggage : 'TBA'}</p>
                            </div>
                            
                            <div className="bg-gray-50 p-3 rounded-xl border border-gray-100 flex items-center gap-3 mb-2">
                                <div className="bg-blue-100 p-2 rounded-full text-blue-600">
                                    {flightStatus.error ? <Wifi size={16} className="text-red-500" /> : <AlertCircle size={16} />}
                                </div>
                                <div className="text-xs text-gray-600">
                                    <span className="font-bold text-[#0F1C20] block mb-0.5">Note</span>
                                    {flight.note}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const TicketView = () => {
            const flights = FLIGHT_DATA;

            return (
                <div className="animate-fade-in px-6 pb-48 pt-24 flex flex-col gap-6"> 
                     <div className="flex justify-between items-center mb-2">
                        <h2 className="text-3xl font-bold text-[#0F1C20]">æˆ‘çš„èˆªç­</h2>
                     </div>
        
                     <div className="space-y-6">
                        {flights.map((flight, idx) => (
                            <FlightTicket 
                                key={idx} 
                                flight={flight} 
                                defaultExpanded={idx === 0} 
                            />
                        ))}
                     </div>
                </div>
            );
        };

        const ChatOverlay = ({ isOpen, onClose, currentModel, setCurrentModel }) => {
            const [messages, setMessages] = useState([
                { role: 'assistant', text: `æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„æ³°åœ‹æ—…éŠåŠ©ç† âœ¨ï¼Œç›®å‰ä½¿ç”¨çš„æ˜¯ ${getModelDisplayName(currentModel)} æ¨¡å‹ã€‚è«‹å•æœ‰ä»€éº¼é—œæ–¼è¯æ¬£æˆ–æ›¼è°·çš„å•é¡Œå—ï¼Ÿ` }
            ]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(scrollToBottom, [messages, isOpen]);

            const handleSend = async () => {
                if (!input.trim() || loading) return;
                const userMessage = { role: 'user', text: input.trim() };
                setMessages(prev => [...prev, userMessage]);
                setInput('');
                setLoading(true);
                
                // Construct Context-Aware Prompt
                const systemPrompt = `
                ä½ æ˜¯ä¸€å€‹å°ˆå±¬çš„æ—…éŠåŠ©ç†ï¼Œæœå‹™é€™è¶Ÿ 13 äººçš„ "Thai Trip 2026" æ³°åœ‹ä¹‹æ—…ã€‚
                ä»¥ä¸‹æ˜¯é€™æ¬¡æ—…ç¨‹çš„è©³ç´°è³‡æ–™ï¼Œè«‹æ ¹æ“šé€™äº›è³‡è¨Šå›ç­”ä½¿ç”¨è€…çš„å•é¡Œï¼š

                ã€è¡Œç¨‹å®‰æ’ (Itinerary)ã€‘
                ${JSON.stringify(TRIP_DATA, null, 2)}

                ã€ä½å®¿åˆ†æˆ¿ (Hotels & Rooms)ã€‘
                ${JSON.stringify(ROOM_DATA, null, 2)}

                ã€èˆªç­è³‡è¨Š (Flights)ã€‘
                ${JSON.stringify(FLIGHT_DATA, null, 2)}

                ã€æ³¨æ„äº‹é …ã€‘
                1. è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ã€‚
                2. å›ç­”è¦ç°¡æ½”ã€å‹å–„ã€‚
                3. å¦‚æœå•é¡Œèˆ‡è¡Œç¨‹æœ‰é—œï¼Œè«‹å„ªå…ˆåƒè€ƒä¸Šè¿°è³‡æ–™ã€‚ä¾‹å¦‚è¢«å•ã€Œæ˜å¤©ä½å“ªè£¡ã€ï¼Œè«‹æ ¹æ“šç›®å‰æ—¥æœŸå›ç­”å°æ‡‰é£¯åº—ã€‚
                4. ä»Šå¤©çš„æ—¥æœŸå‡è¨­ç‚ºæ—…è¡Œå‡ºç™¼å‰æˆ–æ—…é€”ä¸­ï¼ˆä½ å¯ä»¥æ ¹æ“šä½¿ç”¨è€…æå•çš„èªå¢ƒåˆ¤æ–·ï¼‰ã€‚
                `;
                
                const { text } = await callGeminiAPI(userMessage.text, systemPrompt, currentModel, true);
                setMessages(prev => [...prev, { role: 'assistant', text }]);
                setLoading(false);
            };

            const handleUpgrade = () => {
                if (currentModel === LITE_API) {
                    setCurrentModel(FLASH_API);
                    setMessages(prev => [...prev, { role: 'assistant', text: `æ¨¡å‹å·²æˆåŠŸå‡ç´šè‡³ ${getModelDisplayName(FLASH_API)} âœ¨ã€‚ç¾åœ¨ AI å…·å‚™æ›´å¼·å¤§çš„æ¨ç†èƒ½åŠ›ï¼` }]);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !loading) handleSend();
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[60] flex flex-col bg-[#C4E0E0] animate-slide-up">
                    <div className="flex justify-between items-center p-6 pb-2">
                        <h2 className="text-2xl font-bold text-[#0F1C20]">AI æ—…éŠåŠ©ç† âœ¨</h2>
                        <button onClick={onClose} className="p-2 bg-white/50 rounded-full hover:bg-white"><X size={24} className="text-[#0F1C20]" /></button>
                    </div>
                    <div className="flex-1 overflow-y-auto p-6 pt-2 space-y-4 no-scrollbar">
                        {messages.map((msg, idx) => (
                            <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[85%] px-4 py-3 rounded-3xl shadow-md flex items-start gap-3 ${msg.role === 'user' ? 'bg-[#FF9F68] text-[#0F1C20] rounded-br-none' : 'bg-white text-[#0F1C20] rounded-tl-none'}`}>
                                    {msg.role === 'assistant' && <div className="shrink-0 pt-1"><Bot size={16} className="text-[#FF9F68]" /></div>}
                                    <div className="text-sm font-normal whitespace-pre-wrap">{msg.text}</div>
                                </div>
                            </div>
                        ))}
                        {loading && (
                             <div className="flex justify-start">
                                <div className="max-w-[85%] px-4 py-3 rounded-3xl shadow-md bg-white text-[#0F1C20] rounded-tl-none flex items-center gap-2">
                                     <Clock size={16} className="animate-spin text-[#FF9F68]"/> <span className="text-sm">AI æ­£åœ¨æ€è€ƒ...</span>
                                </div>
                             </div>
                        )}
                        <div ref={messagesEndRef} />
                    </div>
                    <div className="p-4 bg-white border-t border-gray-100 pb-8">
                        
                        {currentModel === LITE_API && (
                            <div className="mb-3 text-center">
                                <button 
                                    onClick={handleUpgrade}
                                    className="bg-blue-600 text-white font-bold text-xs px-3 py-1 rounded-full hover:bg-blue-700 transition-colors shadow-md"
                                >
                                    å‡ç´šè‡³ Flash æ¨¡å‹ âœ¨
                                </button>
                                <p className="text-[10px] text-gray-500 mt-1">
                                    ï¼ˆå¦‚æœå° Lite æ¨¡å‹çš„å›è¦†ä¸æ»¿æ„ï¼Œå¯å‡ç´šä»¥ç²å¾—æ›´ä½³çš„æ¨ç†èƒ½åŠ›ï¼‰
                                </p>
                            </div>
                        )}

                         <div className="flex items-center gap-3 bg-gray-100 rounded-full px-4 py-2">
                            <input 
                                type="text" 
                                value={input} 
                                onChange={(e) => setInput(e.target.value)} 
                                onKeyPress={handleKeyPress} 
                                placeholder="è¼¸å…¥ä½ çš„å•é¡Œ..." 
                                className="flex-1 bg-transparent text-[#0F1C20] focus:outline-none font-normal text-base" 
                                disabled={loading} 
                                autoFocus 
                            />
                            <button onClick={handleSend} disabled={!input.trim() || loading} className={`p-2 rounded-full ${!input.trim() || loading ? 'text-gray-400' : 'bg-[#0F1C20] text-[#FF9F68]'}`}><Send size={18} /></button>
                         </div>

                         <div className="text-right mt-1.5">
                            <span className="text-[10px] text-gray-500">
                                ç›®å‰æ¨¡å‹: <span className="font-bold">{getModelDisplayName(currentModel)}</span>
                            </span>
                         </div>
                    </div>
                </div>
            );
        };

        // --- Main App Component ---

        const App = () => {
            const [activeTab, setActiveTab] = useState('home');
            const [selectedHotelForRooms, setSelectedHotelForRooms] = useState('huahin'); 
            const [showChat, setShowChat] = useState(false);
            const [currentModel, setCurrentModel] = useState(LITE_API); // Initialize with Lite Model

            // Background style to match the mint aesthetic
            const bgStyle = {
                backgroundColor: '#C4E0E0', 
                minHeight: '100vh',
                fontFamily: '"Inter", sans-serif',
            };

            return (
                <div style={bgStyle} className="relative text-[#0F1C20]">
                    {/* Main Content Area */}
                    <div className="max-w-md mx-auto bg-[#C4E0E0] h-[100dvh] relative shadow-2xl overflow-hidden flex flex-col">
                        {/* Decorative background blurs */}
                        <div className="absolute top-[-100px] left-[-100px] w-[300px] h-[300px] bg-white opacity-40 blur-[80px] rounded-full pointer-events-none"></div>
                        <div className="absolute bottom-[100px] right-[-50px] w-[200px] h-[200px] bg-[#FF9F68] opacity-20 blur-[60px] rounded-full pointer-events-none"></div>

                        {/* Header takes absolute position now */}
                        <div className="absolute top-0 left-0 right-0 z-30 pointer-events-none">
                            <Header 
                                title={
                                    activeTab === 'home' ? '' : 
                                    activeTab === 'schedule' ? 'è¡Œç¨‹' :
                                    activeTab === 'hotels' ? 'ä½å®¿' : 
                                    activeTab === 'room_list' ? 'åˆ†æˆ¿åå–®' : 
                                    activeTab === 'map' ? 'åœ°åœ–' :
                                    activeTab === 'notes' ? 'æ—…è¡Œé ˆçŸ¥' :
                                    'èˆªç­è³‡è¨Š'
                                }
                                showBack={activeTab !== 'home'}
                                onBack={() => {
                                    if (activeTab === 'room_list') {
                                        setActiveTab('hotels');
                                    } else {
                                        setActiveTab('home');
                                    }
                                }}
                                onOpenChat={() => setShowChat(true)}
                            />
                        </div>

                        {/* Main takes remaining height and scrolls */}
                        <main className="flex-1 overflow-y-auto no-scrollbar relative z-10">
                            {activeTab === 'home' && <HomeView setActiveTab={setActiveTab} />}
                            {activeTab === 'schedule' && <ScheduleView />}
                            {activeTab === 'hotels' && <HotelsView onViewRooms={(hotel) => {
                                setSelectedHotelForRooms(hotel);
                                setActiveTab('room_list');
                            }} />} 
                            {activeTab === 'room_list' && <RoomAllocationView hotel={selectedHotelForRooms} />}
                            {activeTab === 'tickets' && <TicketView />}
                            {activeTab === 'map' && <MapView />}
                            {activeTab === 'notes' && <NotesView />}
                        </main>

                        <PillNav activeTab={activeTab === 'room_list' ? 'hotels' : activeTab} setActiveTab={setActiveTab} />
                        
                        <ChatOverlay 
                            isOpen={showChat} 
                            onClose={() => setShowChat(false)} 
                            currentModel={currentModel}
                            setCurrentModel={setCurrentModel}
                        />
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
