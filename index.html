import React, { useState, useEffect } from 'react';
import { 
  Plane, 
  MapPin, 
  Calendar, 
  Home, 
  User, 
  ArrowRight, 
  ChevronLeft, 
  MoreHorizontal,
  Clock,
  Users,
  Sun,
  Moon,
  Info,
  Map as MapIcon,
  CheckSquare,
  Thermometer,
  Zap,
  Banknote,
  Phone,
  Utensils,
  Coffee,
  ShoppingBag,
  Camera,
  BedDouble,
  RefreshCcw,
  Wifi,
  AlertCircle
} from 'lucide-react';

// ... (前段 useCountdown, PillNav, Header, HomeView, ScheduleView, HotelsView 保持不變)
// ... existing code ...
const useCountdown = (targetDate) => {
  const [timeLeft, setTimeLeft] = useState({ days: 0, hours: 0, minutes: 0, seconds: 0 });

  const calculateTimeLeft = () => {
    const difference = +new Date(targetDate) - +new Date();
    let timeLeft = {};

    if (difference > 0) {
      timeLeft = {
        days: Math.floor(difference / (1000 * 60 * 60 * 24)),
        hours: Math.floor((difference / (1000 * 60 * 60)) % 24),
        minutes: Math.floor((difference / 1000 / 60) % 60),
        seconds: Math.floor((difference / 1000) % 60),
      };
    } else {
       timeLeft = { days: 0, hours: 0, minutes: 0, seconds: 0 };
    }
    return timeLeft;
  };

  useEffect(() => {
    setTimeLeft(calculateTimeLeft());
    const timer = setInterval(() => {
      setTimeLeft(calculateTimeLeft());
    }, 1000);
    return () => clearInterval(timer);
  }, [targetDate]);

  return timeLeft;
};

// --- Components ---

const PillNav = ({ activeTab, setActiveTab }) => {
  return (
    <div className="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-[#0F1C20] rounded-full px-2 py-2 flex items-center shadow-2xl z-50 max-w-[95vw] overflow-x-auto no-scrollbar">
      <button 
        onClick={() => setActiveTab('home')}
        className={`flex items-center gap-2 px-4 py-3 rounded-full transition-all duration-300 whitespace-nowrap ${activeTab === 'home' ? 'bg-[#FF9F68] text-[#0F1C20] font-bold' : 'text-gray-400 hover:text-white'}`}
      >
        <Home size={20} />
        {activeTab === 'home' && <span>首頁</span>}
      </button>
      <button 
        onClick={() => setActiveTab('schedule')}
        className={`flex items-center gap-2 px-4 py-3 rounded-full transition-all duration-300 whitespace-nowrap ${activeTab === 'schedule' ? 'bg-[#FF9F68] text-[#0F1C20] font-bold' : 'text-gray-400 hover:text-white'}`}
      >
        <Calendar size={20} />
        {activeTab === 'schedule' && <span>行程</span>}
      </button>
       <button 
        onClick={() => setActiveTab('map')}
        className={`flex items-center gap-2 px-4 py-3 rounded-full transition-all duration-300 whitespace-nowrap ${activeTab === 'map' ? 'bg-[#FF9F68] text-[#0F1C20] font-bold' : 'text-gray-400 hover:text-white'}`}
      >
        <MapIcon size={20} />
        {activeTab === 'map' && <span>地圖</span>}
      </button>
      <button 
        onClick={() => setActiveTab('hotels')}
        className={`flex items-center gap-2 px-4 py-3 rounded-full transition-all duration-300 whitespace-nowrap ${activeTab === 'hotels' ? 'bg-[#FF9F68] text-[#0F1C20] font-bold' : 'text-gray-400 hover:text-white'}`}
      >
        <MapPin size={20} />
        {activeTab === 'hotels' && <span>住宿</span>}
      </button>
       <button 
        onClick={() => setActiveTab('notes')}
        className={`flex items-center gap-2 px-4 py-3 rounded-full transition-all duration-300 whitespace-nowrap ${activeTab === 'notes' ? 'bg-[#FF9F68] text-[#0F1C20] font-bold' : 'text-gray-400 hover:text-white'}`}
      >
        <Info size={20} />
        {activeTab === 'notes' && <span>須知</span>}
      </button>
      <button 
        onClick={() => setActiveTab('tickets')}
        className={`flex items-center gap-2 px-4 py-3 rounded-full transition-all duration-300 whitespace-nowrap ${activeTab === 'tickets' ? 'bg-[#FF9F68] text-[#0F1C20] font-bold' : 'text-gray-400 hover:text-white'}`}
      >
        <Plane size={20} />
        {activeTab === 'tickets' && <span>機票</span>}
      </button>
    </div>
  );
};

const Header = ({ title, showBack = false }) => (
  <div className="flex justify-between items-center mb-6 pt-4 px-2">
    {showBack ? (
      <button className="p-3 bg-white/20 backdrop-blur-sm rounded-full hover:bg-white/30 transition">
        <ChevronLeft size={24} className="text-[#0F1C20]" />
      </button>
    ) : (
      <div className="p-3"></div>
    )}
    <h1 className="text-xl font-bold text-[#0F1C20] tracking-wide">{title}</h1>
    <button className="p-3 border border-[#0F1C20]/10 rounded-full hover:bg-white/10 transition">
      <MoreHorizontal size={24} className="text-[#0F1C20]" />
    </button>
  </div>
);

// --- Views ---

const HomeView = () => {
  // Countdown to Flight Check-in/Meeting time: Feb 25, 2026 19:45
  const timeLeft = useCountdown('2026-02-25T19:45:00');

  return (
    <div className="animate-fade-in pb-24">
      <div className="px-6 mb-8">
        <h2 className="text-4xl font-bold text-[#0F1C20] leading-tight mb-2">
          Discover <br/>
          Thailand <span className="italic font-serif font-light">with us!</span>
        </h2>
        <div className="flex items-center gap-2 text-[#0F1C20]/60 mt-2 font-medium">
          <Users size={18} />
          <span>13 人親友團</span>
          <span className="mx-2">•</span>
          <span>2026.02.25 - 03.02</span>
        </div>
      </div>

      {/* Countdown Card */}
      <div className="mx-6 mb-8 bg-[#0F1C20] rounded-[30px] p-6 text-white shadow-xl relative overflow-hidden">
        <div className="absolute top-0 right-0 w-32 h-32 bg-[#FF9F68] rounded-full filter blur-[60px] opacity-20"></div>
        <h3 className="text-lg text-gray-400 mb-4">距離桃園機場集合還有</h3>
        <div className="flex justify-between items-end">
          <div className="text-center flex-1">
            <span className="text-2xl sm:text-3xl font-bold text-[#FF9F68]">{timeLeft.days || 0}</span>
            <p className="text-[10px] sm:text-xs text-gray-500 uppercase tracking-wider mt-1">Days</p>
          </div>
          <div className="text-xl sm:text-2xl font-light text-gray-600 mb-4">:</div>
          <div className="text-center flex-1">
            <span className="text-2xl sm:text-3xl font-bold text-white">{timeLeft.hours || 0}</span>
            <p className="text-[10px] sm:text-xs text-gray-500 uppercase tracking-wider mt-1">Hrs</p>
          </div>
           <div className="text-xl sm:text-2xl font-light text-gray-600 mb-4">:</div>
          <div className="text-center flex-1">
            <span className="text-2xl sm:text-3xl font-bold text-white">{timeLeft.minutes || 0}</span>
            <p className="text-[10px] sm:text-xs text-gray-500 uppercase tracking-wider mt-1">Mins</p>
          </div>
          <div className="text-xl sm:text-2xl font-light text-gray-600 mb-4">:</div>
          <div className="text-center flex-1">
            <span className="text-2xl sm:text-3xl font-bold text-[#FF9F68] w-8 inline-block text-center tabular-nums">
              {String(timeLeft.seconds || 0).padStart(2, '0')}
            </span>
            <p className="text-[10px] sm:text-xs text-gray-500 uppercase tracking-wider mt-1">Secs</p>
          </div>
        </div>
      </div>

      {/* Destinations Horizontal Scroll */}
      <div className="mb-4 px-6 flex justify-between items-end">
        <h3 className="text-xl font-bold text-[#0F1C20]">目的地</h3>
        <span className="text-sm text-[#FF9F68] font-bold cursor-pointer">View All</span>
      </div>

      <div className="flex overflow-x-auto px-6 gap-4 pb-4 no-scrollbar snap-x">
        {/* Bangkok Card */}
        <div className="min-w-[280px] h-[360px] bg-[#FF9F68] rounded-[35px] p-6 relative flex flex-col justify-between shadow-lg snap-center group cursor-pointer transition-transform hover:scale-[1.02]">
           <div className="absolute inset-0 rounded-[35px] overflow-hidden">
             <div className="absolute inset-0 bg-gradient-to-b from-black/10 to-black/40 z-10"></div>
             <div className="w-full h-full bg-orange-300">
                <img src="/api/placeholder/280/360" alt="Bangkok" className="w-full h-full object-cover opacity-80 mix-blend-multiply" />
             </div>
           </div>
           <div className="relative z-20">
             <span className="text-white/90 text-sm font-bold tracking-wider uppercase">Capital</span>
             <h2 className="text-5xl font-bold text-white mt-2 drop-shadow-md">Bang<br/>kok</h2>
           </div>
           <div className="relative z-20 flex justify-between items-end">
             <div>
                <p className="text-white/90 text-sm font-medium">Starting</p>
                <p className="text-white text-2xl font-bold">2/25</p>
             </div>
             <div className="flex gap-2">
               <button className="w-12 h-12 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white hover:bg-white hover:text-[#FF9F68] transition-colors">
                 <ArrowRight size={20} />
               </button>
             </div>
           </div>
        </div>

        {/* Hua Hin Card */}
        <div className="min-w-[280px] h-[360px] bg-[#2E5C55] rounded-[35px] p-6 relative flex flex-col justify-between shadow-lg snap-center group cursor-pointer transition-transform hover:scale-[1.02]">
           <div className="absolute inset-0 rounded-[35px] overflow-hidden">
             <div className="absolute inset-0 bg-gradient-to-b from-black/10 to-black/40 z-10"></div>
             <div className="w-full h-full bg-teal-800">
                <img src="/api/placeholder/280/360" alt="Hua Hin" className="w-full h-full object-cover opacity-60 mix-blend-overlay" />
             </div>
           </div>
           <div className="relative z-20">
             <span className="text-white/90 text-sm font-bold tracking-wider uppercase">Beach Resort</span>
             <h2 className="text-5xl font-bold text-white mt-2 drop-shadow-md">Hua<br/>Hin</h2>
           </div>
           <div className="relative z-20 flex justify-between items-end">
             <div>
                <p className="text-white/90 text-sm font-medium">Starting</p>
                <p className="text-white text-2xl font-bold">2/26</p>
             </div>
             <div className="flex gap-2">
               <button className="w-12 h-12 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white hover:bg-white hover:text-[#2E5C55] transition-colors">
                 <ArrowRight size={20} />
               </button>
             </div>
           </div>
        </div>
      </div>
    </div>
  );
};

const ScheduleView = () => {
  const [selectedDay, setSelectedDay] = useState('2/25');

  const timelineData = {
    '2/25': {
      title: "Departure Night",
      desc: "Taoyuan Airport -> Bangkok",
      icon: <Plane size={20} />,
      events: [
        { time: "19:45", title: "桃園機場集合", desc: "TPE 桃園機場集合 (無網上報到，需臨櫃)", icon: "users" },
        { time: "21:15", title: "搭乘 SL395 起飛", desc: "前往曼谷廊曼機場 (DMK)", icon: "plane" },
        { time: "00:15", title: "抵達曼谷 DMK", desc: "預計抵達時間 (跨日 2/26)", icon: "map-pin" },
        { time: "01:15", title: "入住飯店", desc: "SHIN Patara Living Hotel", icon: "moon" }
      ]
    },
    '2/26': {
      title: "Hua Hin Transfer",
      desc: "Bangkok -> Hua Hin Beach",
      icon: <Sun size={20} />,
      events: [
        { time: "09:00", title: "換錢小分隊出動", desc: "協助大家換華欣兩日花費", icon: "banknote" },
        { time: "10:00", title: "包車前往華欣", desc: "車程約 3-3.5 小時，中途停 7-11/Amazon", icon: "car" },
        { time: "13:00", title: "抵達飯店", desc: "The Standard Hua Hin", icon: "home" },
        { time: "14:00", title: "午餐 Nong JJ", desc: "在地知名餐廳", icon: "utensils", link: "https://maps.app.goo.gl/SjoAAn4g1RwRJu6y5" },
        { time: "15:30", title: "自由活動", desc: "享受飯店設施或海灘", icon: "coffee" },
        { time: "19:30", title: "晚餐 Praça", desc: "飯店內餐廳享用泰式料理", icon: "utensils", link: "https://maps.app.goo.gl/YVReUVe6M383Uzgz9" }
      ]
    },
    '2/27': {
      title: "Explore or Chill",
      desc: "Sam Roi Yot / Night Markets",
      icon: <Camera size={20} />,
      events: [
        { time: "06:30", title: "早餐 / 準備出發", desc: "參加三百峰者先行用餐", icon: "coffee" },
        { time: "08:00", title: "三百峰國家公園", desc: "私人探索之旅 (參加者出發)", icon: "camera" },
        { time: "09:00", title: "自由活動", desc: "沒參加行程者可享受飯店/按摩", icon: "sun" },
        { time: "18:30", title: "集合逛夜市", desc: "Cicada + Tamarind Night Markets", icon: "shopping-bag" },
        { time: "21:00", title: "按摩/購物", desc: "Let's Relax Spa 或 Blúport 大賣場", icon: "moon" }
      ]
    },
    '2/28': {
      title: "Back to BKK",
      desc: "Hua Hin -> Bangkok City",
      icon: <ShoppingBag size={20} />,
      events: [
        { time: "09:00", title: "包車回曼谷", desc: "車程約 3-3.5 小時", icon: "car" },
        { time: "12:00", title: "Check-in BKK", desc: "ASAI Bangkok Chinatown", icon: "home" },
        { time: "12:30", title: "午餐 Ari 區", desc: "Ari 區享用午餐", icon: "utensils" },
        { 
          time: "14:00", 
          title: "自由逛街路線 (三選一)", 
          desc: (
            <ul className="space-y-3 mt-3">
              <li className="flex gap-2 items-start">
                <span className="shrink-0 font-bold bg-[#0F1C20] text-[#FF9F68] text-[10px] px-1.5 rounded py-0.5 mt-0.5">A</span>
                <span><span className="font-bold">恰圖恰 + DD Mall</span> 逛街 ➔ 隨後前往嵩越路逛街</span>
              </li>
              <li className="flex gap-2 items-start">
                <span className="shrink-0 font-bold bg-[#0F1C20] text-[#FF9F68] text-[10px] px-1.5 rounded py-0.5 mt-0.5">B</span>
                <span>叫車至 <span className="font-bold">泰國設計中心 (TCDC)</span> 或搭 BTS 到 Saphan Taksin 站 ➔ 慢慢逛到嵩越路</span>
              </li>
              <li className="flex gap-2 items-start">
                <span className="shrink-0 font-bold bg-[#0F1C20] text-[#FF9F68] text-[10px] px-1.5 rounded py-0.5 mt-0.5">C</span>
                <span>直接在 <span className="font-bold">Ari 區</span> 逛街喝咖啡休息 ➔ 隨後前往嵩越路逛街</span>
              </li>
            </ul>
          ), 
          icon: "map" 
        },
        { time: "18:30", title: "晚餐 Lon Lon Local Diner", desc: "集合吃晚餐", icon: "utensils", link: "https://maps.app.goo.gl/oDgChLURo5wJHGYF7" },
        { time: "20:00", title: "晚間活動", desc: "按摩 / BigC 採買 / 休息", icon: "moon" }
      ]
    },
  };

  const days = [
    { date: '2/25', day: 'Wed', active: selectedDay === '2/25' },
    { date: '2/26', day: 'Thu', active: selectedDay === '2/26' },
    { date: '2/27', day: 'Fri', active: selectedDay === '2/27' },
    { date: '2/28', day: 'Sat', active: selectedDay === '2/28' },
    { date: '3/1', day: 'Sun', active: selectedDay === '3/1' }, // Placeholder
    { date: '3/2', day: 'Mon', active: selectedDay === '3/2' }, // Placeholder
  ];

  const currentData = timelineData[selectedDay] || { title: "Coming Soon", desc: "Details to be added", icon: <Clock size={20}/>, events: [] };

  return (
    <div className="animate-fade-in px-6 pb-24">
      <h2 className="text-3xl font-bold text-[#0F1C20] mb-6">Itinerary</h2>
      
      {/* Date Filters */}
      <div className="flex gap-3 overflow-x-auto pb-6 no-scrollbar">
        {days.map((item, idx) => (
          <div 
            key={idx} 
            onClick={() => setSelectedDay(item.date)}
            className={`flex flex-col items-center justify-center min-w-[70px] h-[90px] rounded-[24px] border transition-all cursor-pointer ${item.active ? 'bg-[#0F1C20] text-white border-[#0F1C20]' : 'bg-white border-transparent text-gray-400'}`}
          >
            <span className="text-xs font-medium mb-1">{item.day}</span>
            <span className="text-xl font-bold">{item.date}</span>
          </div>
        ))}
      </div>

      {/* Timeline Card */}
      <div className="space-y-4">
        <div className="bg-[#FF9F68] rounded-[30px] p-6 text-[#0F1C20] relative overflow-hidden min-h-[400px]">
          <div className="absolute -right-4 -top-4 w-24 h-24 bg-white/20 rounded-full blur-xl"></div>
          
          {/* Header */}
          <div className="flex justify-between items-start mb-8 relative z-10">
            <div>
              <p className="font-bold opacity-70">{currentData.desc}</p>
              <h3 className="text-2xl font-bold mt-1">{currentData.title}</h3>
            </div>
            <div className="bg-[#0F1C20] w-12 h-12 rounded-full flex items-center justify-center text-white">
              {currentData.icon}
            </div>
          </div>
          
          {/* Timeline Events */}
          <div className="space-y-6 relative z-10">
            {currentData.events.map((event, idx) => (
              <div key={idx} className="flex gap-4 items-start group">
                <div className="w-14 font-bold text-right shrink-0 pt-1">{event.time}</div>
                <div className={`flex-1 pb-4 ${idx !== currentData.events.length - 1 ? 'border-l-2 border-[#0F1C20]/20' : ''} pl-4 relative`}>
                  <div className={`absolute -left-[9px] top-1 w-4 h-4 rounded-full ${idx === 0 ? 'bg-[#0F1C20]' : 'bg-white border-2 border-[#0F1C20]'}`}></div>
                  <h4 className="font-bold text-lg leading-tight">{event.title}</h4>
                  <div className="text-sm opacity-80 mt-1">{event.desc}</div>
                  {event.link && (
                    <a href={event.link} target="_blank" rel="noopener noreferrer" className="inline-flex items-center gap-1 mt-2 text-xs font-bold bg-white/30 px-2 py-1 rounded-full hover:bg-white/50 transition-colors">
                      Open Map <ArrowRight size={10} />
                    </a>
                  )}
                </div>
              </div>
            ))}
            
            {currentData.events.length === 0 && (
              <div className="text-center opacity-60 py-10">
                尚未更新詳細行程
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

const HotelsView = () => {
  return (
    <div className="animate-fade-in px-6 pb-24">
      <div className="flex justify-between items-end mb-6">
        <h2 className="text-3xl font-bold text-[#0F1C20] leading-none">
          Your <br/> Hotels <span className="italic font-serif font-light">Booked</span>
        </h2>
        <div className="p-3 border border-gray-300 rounded-full">
           <MapPin size={20} className="text-[#0F1C20]"/>
        </div>
      </div>

      {/* Main Hotel: The Standard */}
      <div className="w-full aspect-[4/5] rounded-[40px] bg-[#0F1C20] relative mb-6 overflow-hidden group">
        <div className="absolute inset-0">
          <img src="/api/placeholder/400/500" alt="The Standard Hua Hin" className="w-full h-full object-cover opacity-60" />
        </div>
        
        <div className="absolute top-6 left-6 right-6 flex justify-between items-start z-10">
          <div>
            <h3 className="text-3xl font-bold text-white leading-tight">The Standard<br/>Hua Hin</h3>
            <p className="text-white/70">Feb 26 - 28</p>
          </div>
          <button className="w-12 h-12 bg-[#C4E0E0] rounded-full flex items-center justify-center text-[#0F1C20]">
            <CheckSquare size={24} />
          </button>
        </div>

        <div className="absolute bottom-6 left-6 right-6 h-20 bg-white/10 backdrop-blur-md rounded-[24px] border border-white/20 flex items-center justify-between px-2 z-10">
           <div className="bg-white/20 rounded-[20px] px-6 py-3 h-16 flex items-center gap-1">
             <span className="text-lg font-bold text-white">Main Resort</span>
           </div>
           <div className="h-16 w-16 bg-[#0F1C20] rounded-full flex items-center justify-center text-white font-bold border border-white/10">
             5.0
           </div>
        </div>
      </div>

      {/* List items */}
      <div className="space-y-3">
        <div className="bg-[#FF9F68] rounded-[24px] p-5 flex justify-between items-center cursor-pointer transition hover:bg-[#ff8a50]">
          <div>
            <div className="flex items-center gap-2 mb-1">
              <span className="bg-[#0F1C20] text-white text-[10px] px-2 py-0.5 rounded-full">Arrival Night</span>
            </div>
            <h4 className="font-bold text-[#0F1C20] text-lg">SHIN Patara Living</h4>
            <p className="text-[#0F1C20]/70 text-sm">Feb 26 (01:15 AM check-in)</p>
          </div>
          <BedDouble size={20} className="text-[#0F1C20]" />
        </div>
        
        <div className="bg-[#C4E0E0] rounded-[24px] p-5 flex justify-between items-center cursor-pointer transition hover:bg-[#b2d8d8]">
          <div>
             <div className="flex items-center gap-2 mb-1">
              <span className="bg-[#0F1C20] text-white text-[10px] px-2 py-0.5 rounded-full">Bangkok Base</span>
            </div>
            <h4 className="font-bold text-[#0F1C20] text-lg">ASAI Chinatown</h4>
            <p className="text-[#0F1C20]/70 text-sm">Feb 28 - Mar 2</p>
          </div>
          <BedDouble size={20} className="text-[#0F1C20]" />
        </div>
      </div>
    </div>
  );
};

const TicketView = () => {
  // -------------------------------------------------------------
  // TODO: Get your FREE API Key from https://airlabs.co/
  // Replace the empty string below with your key: e.g., 'your-key-here'
  // -------------------------------------------------------------
  const API_KEY = ''; 

  const [flightStatus, setFlightStatus] = useState({
    status: 'Scheduled', 
    gate: 'TBA',
    terminal: '1',
    estimatedDep: '21:15',
    lastUpdated: null,
    loading: false,
    isRealData: false
  });

  const fetchFlightData = async () => {
    setFlightStatus(prev => ({ ...prev, loading: true }));
    
    // Fallback Mock Data (Simulated)
    const mockData = {
      status: 'On Time',
      gate: 'B4', 
      terminal: '1',
      estimatedDep: '21:15',
      lastUpdated: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
      loading: false,
      isRealData: false
    };

    if (!API_KEY) {
      // Simulate network delay then use mock
      await new Promise(resolve => setTimeout(resolve, 1000));
      setFlightStatus(mockData);
      return;
    }

    try {
      // Fetching Today's active flight from AirLabs
      const response = await fetch(`https://airlabs.co/api/v9/flight?flight_iata=SL395&api_key=${API_KEY}`);
      const data = await response.json();

      if (data.response) {
        // Map AirLabs data to our state
        const f = data.response; 
        const now = new Date();
        setFlightStatus({
          status: f.status || 'Scheduled',
          gate: f.dep_gate || 'TBA',
          terminal: f.dep_terminal || '1',
          estimatedDep: f.dep_estimated ? f.dep_estimated.split(' ')[1] : '21:15',
          lastUpdated: now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
          loading: false,
          isRealData: true
        });
      } else {
        console.warn("Flight not found active today, using mock.");
        setFlightStatus(mockData);
      }
    } catch (error) {
      console.error("API Error, using mock:", error);
      setFlightStatus(mockData);
    }
  };

  useEffect(() => {
    fetchFlightData();
    // Auto-refresh every 5 minutes
    const interval = setInterval(fetchFlightData, 300000);
    return () => clearInterval(interval);
  }, []);

  const getStatusColor = (status) => {
    const s = status.toLowerCase();
    if (s.includes('active') || s.includes('en-route') || s.includes('time')) return 'text-green-500';
    if (s.includes('delayed')) return 'text-red-500';
    if (s.includes('landed')) return 'text-blue-500';
    return 'text-white';
  };

  return (
    <div className="animate-fade-in px-6 pb-24 h-full flex flex-col">
       <div className="flex justify-between items-center mb-6">
         <h2 className="text-3xl font-bold text-[#0F1C20]">Your Ticket</h2>
         <div className="flex gap-2">
            <button 
              onClick={fetchFlightData}
              className={`p-2 rounded-full bg-white/50 hover:bg-white text-[#0F1C20] transition-all ${flightStatus.loading ? 'animate-spin' : ''}`}
            >
              <RefreshCcw size={18} />
            </button>
         </div>
       </div>

       {/* Ticket Card */}
       <div className="bg-white rounded-[35px] overflow-hidden shadow-xl flex flex-col relative w-full max-w-md mx-auto">
         {/* Top Dark Section */}
         <div className="bg-[#0F1C20] p-8 text-white relative">
           {/* Live Indicator */}
           <div className="absolute top-6 right-6 flex items-center gap-2 bg-black/30 px-3 py-1 rounded-full backdrop-blur-sm border border-white/10">
              <div className={`w-2 h-2 rounded-full ${flightStatus.isRealData ? 'bg-green-500' : 'bg-yellow-500'} animate-pulse shadow-[0_0_8px_rgba(34,197,94,0.6)]`}></div>
              <span className="text-[10px] font-bold tracking-wider uppercase">
                {flightStatus.isRealData ? 'Live (AirLabs)' : 'Simulated'}
              </span>
           </div>

           <div className="flex justify-between items-start mb-8 mt-2">
             <div>
               <p className="text-gray-400 text-xs font-bold uppercase tracking-widest mb-1">Airline</p>
               <p className="text-xl font-bold text-[#FF9F68]">Thai Lion Air</p>
             </div>
             <div className="text-right mt-8"> 
               <p className="text-gray-400 text-xs font-bold uppercase tracking-widest mb-1">Flight</p>
               <p className="text-3xl font-bold">SL395</p>
             </div>
           </div>

           <div className="flex justify-between items-center mb-4">
             <div className="text-xs text-gray-400">2026.02.25</div>
             <div className={`text-sm font-bold ${getStatusColor(flightStatus.status)} flex items-center gap-1`}>
                {flightStatus.status}
                {flightStatus.status.includes('ime') && <CheckSquare size={12} />}
             </div>
             <div className="text-xs text-gray-400">04h 00m</div>
           </div>
           
           {/* Visual Route Line */}
           <div className="flex items-center justify-between relative mb-2">
              <div className="w-3 h-3 bg-[#FF9F68] rounded-full z-10"></div>
              <div className="h-[2px] bg-gray-700 w-full absolute top-1/2 left-0"></div>
              <div className="w-3 h-3 bg-[#FF9F68] rounded-full z-10"></div>
           </div>

           <div className="flex justify-between text-lg font-bold tracking-wide">
             <span>TPE</span>
             <span>DMK</span>
           </div>
           <div className="flex justify-between text-xs text-gray-400 mt-1">
             <div>
               <span className="block text-gray-500 mb-1">Scheduled</span>
               <span>21:15</span>
             </div>
             <div className="text-right">
                <span className="block text-gray-500 mb-1">Estimated</span>
                <span className={flightStatus.status.includes('Delayed') ? 'text-red-400' : 'text-white'}>
                  {flightStatus.estimatedDep} (+1)
                </span>
             </div>
           </div>

           {/* Decorative Circles */}
           <div className="absolute -bottom-4 -left-4 w-8 h-8 bg-[#C4E0E0] rounded-full z-20"></div>
           <div className="absolute -bottom-4 -right-4 w-8 h-8 bg-[#C4E0E0] rounded-full z-20"></div>
         </div>

         {/* Dashed Line */}
         <div className="h-8 bg-white relative flex items-center justify-center">
            <div className="w-[90%] border-t-2 border-dashed border-gray-300"></div>
         </div>

         {/* Bottom White Section */}
         <div className="bg-white p-8 pt-2">
            <div className="flex justify-between items-center mb-4">
               <div>
                  <p className="text-gray-400 text-xs font-bold uppercase">Terminal</p>
                  <p className="text-[#0F1C20] font-bold text-lg">{flightStatus.terminal}</p>
               </div>
               <div className="text-right">
                  <p className="text-gray-400 text-xs font-bold uppercase">Gate</p>
                  <p className="text-[#0F1C20] font-bold text-2xl animate-pulse text-indigo-600">
                    {flightStatus.loading ? '...' : flightStatus.gate}
                  </p>
               </div>
                <div className="text-right">
                  <p className="text-gray-400 text-xs font-bold uppercase">Meeting</p>
                  <p className="text-red-500 font-bold text-lg">19:45</p>
               </div>
            </div>
            
            <div className="bg-gray-50 p-3 rounded-xl border border-gray-100 flex items-center gap-3 mb-6">
               <div className="bg-blue-100 p-2 rounded-full text-blue-600">
                 <AlertCircle size={16} />
               </div>
               <div className="text-xs text-gray-600">
                  <span className="font-bold text-[#0F1C20] block mb-0.5">Note</span>
                  No Online Check-in available.
               </div>
            </div>

            {/* Barcode Mockup */}
            <div className="h-16 bg-[#FF9F68] rounded-xl flex items-center justify-center overflow-hidden relative">
               <div className="flex items-end gap-[2px] h-full w-full justify-center opacity-80 mix-blend-multiply px-4 py-2">
                 {[...Array(40)].map((_, i) => (
                   <div key={i} className="bg-[#0F1C20]" style={{
                     width: Math.random() > 0.5 ? '4px' : '2px',
                     height: `${30 + Math.random() * 70}%`
                   }}></div>
                 ))}
               </div>
               <p className="absolute bottom-1 text-[10px] font-mono tracking-[0.2em] text-[#0F1C20]">SL395-TPE-DMK-LIVE</p>
            </div>

            <div className="mt-4 flex justify-between items-center text-[10px] text-gray-400 font-mono">
               <span>
                 Source: {flightStatus.isRealData ? 'AirLabs (Real-time)' : 'System (Simulated)'}
               </span>
               <span>Updated: {flightStatus.lastUpdated || '--:--'}</span>
            </div>
         </div>
       </div>
    </div>
  );
};

// ... (NotesView, MapView, App 保持不變)
// ... existing code ...
const NotesView = () => {
  const [checklist, setChecklist] = useState([
    { id: 1, text: "護照 (效期6個月以上)", checked: false },
    { id: 2, text: "泰國網卡/漫遊", checked: false },
    { id: 3, text: "泰銖 (建議每人 2000 THB)", checked: false },
    { id: 4, text: "防曬乳/墨鏡/帽子", checked: false },
    { id: 5, text: "個人藥品/腸胃藥", checked: false },
    { id: 6, text: "泳衣 (華欣飯店泳池)", checked: false },
  ]);

  const toggleCheck = (id) => {
    setChecklist(checklist.map(item => 
      item.id === id ? { ...item, checked: !item.checked } : item
    ));
  };

  const infoCards = [
    {
      title: "天氣 Weather",
      icon: <Thermometer className="text-[#FF9F68]" />,
      content: "2月-3月是泰國乾季偏熱，平均氣溫 25-34°C。建議穿著透氣衣物。",
      bgColor: "bg-[#0F1C20]",
      textColor: "text-white"
    },
    {
      title: "電壓 Voltage",
      icon: <Zap className="text-[#FF9F68]" />,
      content: "220V，插座通常通用台灣雙扁插頭 (Type A/C)，不需轉接頭，但需注意電壓。",
      bgColor: "bg-white",
      textColor: "text-[#0F1C20]"
    },
    {
      title: "匯率 Currency",
      icon: <Banknote className="text-[#FF9F68]" />,
      content: "1 TWD ≈ 1.1 THB。建議在台灣換少量，帶台幣去 Superrich 換匯最划算。",
      bgColor: "bg-white",
      textColor: "text-[#0F1C20]"
    },
    {
      title: "緊急聯絡 Emergency",
      icon: <Phone className="text-[#FF9F68]" />,
      content: "觀光警察: 1155\n救護車: 1669\n台灣駐泰辦事處: +66-81-666-4006",
      bgColor: "bg-[#FF9F68]",
      textColor: "text-[#0F1C20]"
    }
  ];

  return (
    <div className="animate-fade-in px-6 pb-24">
      <h2 className="text-3xl font-bold text-[#0F1C20] mb-6">Important Info</h2>

      {/* Info Grid */}
      <div className="grid grid-cols-2 gap-4 mb-8">
        {infoCards.map((card, idx) => (
          <div key={idx} className={`${card.bgColor} rounded-[24px] p-5 shadow-sm flex flex-col justify-between min-h-[160px]`}>
            <div className="flex justify-between items-start">
              <div className={`p-2 rounded-full ${card.bgColor === 'bg-white' ? 'bg-gray-100' : 'bg-white/10'}`}>
                {card.icon}
              </div>
            </div>
            <div>
              <h4 className={`font-bold text-sm mb-1 ${card.textColor}`}>{card.title}</h4>
              <p className={`text-xs opacity-80 whitespace-pre-line ${card.textColor}`}>{card.content}</p>
            </div>
          </div>
        ))}
      </div>

      {/* Checklist Section */}
      <div className="bg-white rounded-[30px] p-6 shadow-sm">
        <div className="flex items-center gap-3 mb-4">
           <div className="bg-[#C4E0E0] p-2 rounded-full text-[#0F1C20]">
             <CheckSquare size={20} />
           </div>
           <h3 className="text-xl font-bold text-[#0F1C20]">Packing List</h3>
        </div>
        
        <div className="space-y-3">
          {checklist.map((item) => (
            <div 
              key={item.id} 
              onClick={() => toggleCheck(item.id)}
              className="flex items-center gap-4 p-3 rounded-xl hover:bg-gray-50 cursor-pointer transition"
            >
              <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ${item.checked ? 'bg-[#FF9F68] border-[#FF9F68]' : 'border-gray-300'}`}>
                {item.checked && <CheckSquare size={14} className="text-white" />}
              </div>
              <span className={`flex-1 font-medium ${item.checked ? 'text-gray-400 line-through' : 'text-[#0F1C20]'}`}>
                {item.text}
              </span>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

const MapView = () => {
  // Mock data for map markers
  const locations = [
    { id: 1, name: "DMK Airport", type: "Airport", top: "15%", left: "65%" },
    { id: 2, name: "BKK City", type: "City", top: "35%", left: "60%" },
    { id: 3, name: "Hua Hin", type: "Resort", top: "75%", left: "30%" },
    { id: 4, name: "Sam Roi Yot", type: "Park", top: "85%", left: "25%" },
  ];

  return (
    <div className="animate-fade-in px-6 pb-24 h-full flex flex-col">
       <div className="flex justify-between items-center mb-6">
         <h2 className="text-3xl font-bold text-[#0F1C20]">Trip Map</h2>
       </div>

       {/* Map Container */}
       <div className="flex-1 bg-[#a3ccce] rounded-[35px] relative overflow-hidden shadow-inner border-4 border-white h-[400px]">
         {/* Decorative map elements mimicking water/land */}
         <div className="absolute inset-0 opacity-30">
            {/* Land mass shape approximation */}
            <div className="absolute top-0 left-0 w-[70%] h-full bg-[#e8f5e9] rounded-r-[100px]"></div>
            {/* Grid lines */}
            <div className="w-full h-full" style={{ backgroundImage: 'radial-gradient(#2E5C55 1px, transparent 1px)', backgroundSize: '20px 20px', opacity: 0.2 }}></div>
         </div>

         {/* Path Line */}
         <svg className="absolute inset-0 w-full h-full pointer-events-none z-0">
           <path d="M240 120 Q 220 250 110 500" stroke="#FF9F68" strokeWidth="3" strokeDasharray="6 4" fill="none" />
         </svg>

         {/* Markers */}
         {locations.map((loc) => (
           <div 
            key={loc.id}
            className="absolute transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center group cursor-pointer"
            style={{ top: loc.top, left: loc.left }}
           >
             <div className="relative">
               <div className="w-4 h-4 bg-[#FF9F68] rounded-full animate-ping absolute inset-0 opacity-75"></div>
               <div className="w-4 h-4 bg-[#0F1C20] rounded-full border-2 border-white relative z-10"></div>
             </div>
             <div className="mt-2 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-bold text-[#0F1C20] shadow-sm transform transition-transform group-hover:scale-110 whitespace-nowrap">
               {loc.name}
             </div>
           </div>
         ))}

         {/* Legend / Info Box */}
         <div className="absolute bottom-6 left-6 right-6 bg-white/90 backdrop-blur-md rounded-[20px] p-4 shadow-lg">
            <div className="flex items-center gap-3 mb-2">
               <div className="bg-[#FF9F68] p-2 rounded-full text-white">
                 <MapIcon size={16} />
               </div>
               <div>
                 <h4 className="font-bold text-[#0F1C20]">2.5 hrs Drive</h4>
                 <p className="text-xs text-gray-500">Bangkok to Hua Hin</p>
               </div>
            </div>
            <div className="h-1 w-full bg-gray-200 rounded-full mt-2 overflow-hidden">
               <div className="h-full bg-[#0F1C20] w-[60%]"></div>
            </div>
         </div>
       </div>
    </div>
  );
};

// --- Main App Component ---

const App = () => {
  const [activeTab, setActiveTab] = useState('home');

  // Background style to match the mint aesthetic
  const bgStyle = {
    backgroundColor: '#C4E0E0', // Matching the minty blue from the image
    minHeight: '100vh',
    fontFamily: '"Inter", sans-serif',
  };

  return (
    <div style={bgStyle} className="relative text-[#0F1C20]">
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Playfair+Display:ital@1&display=swap');
        
        .no-scrollbar::-webkit-scrollbar {
          display: none;
        }
        .no-scrollbar {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
        
        .font-serif {
          font-family: 'Playfair Display', serif;
        }
        
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
          animation: fadeIn 0.4s ease-out forwards;
        }
      `}</style>

      {/* Main Content Area */}
      <div className="max-w-md mx-auto bg-[#C4E0E0] min-h-screen relative shadow-2xl overflow-hidden">
        {/* Decorative background blurs */}
        <div className="absolute top-[-100px] left-[-100px] w-[300px] h-[300px] bg-white opacity-40 blur-[80px] rounded-full pointer-events-none"></div>
        <div className="absolute bottom-[100px] right-[-50px] w-[200px] h-[200px] bg-[#FF9F68] opacity-20 blur-[60px] rounded-full pointer-events-none"></div>

        <Header 
          title={
            activeTab === 'home' ? '' : 
            activeTab === 'schedule' ? 'Trip Itinerary' :
            activeTab === 'hotels' ? 'Hotels' : 
            activeTab === 'map' ? 'Trip Map' :
            activeTab === 'notes' ? 'Travel Info' :
            'Boarding Pass'
          }
          showBack={activeTab !== 'home'}
        />

        <main className="relative z-10 h-[calc(100vh-140px)] overflow-y-auto no-scrollbar">
          {activeTab === 'home' && <HomeView />}
          {activeTab === 'schedule' && <ScheduleView />}
          {activeTab === 'hotels' && <HotelsView />}
          {activeTab === 'tickets' && <TicketView />}
          {activeTab === 'map' && <MapView />}
          {activeTab === 'notes' && <NotesView />}
        </main>

        <PillNav activeTab={activeTab} setActiveTab={setActiveTab} />
      </div>
    </div>
  );
};

export default App;
